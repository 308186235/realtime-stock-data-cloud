<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .loading {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— åç«¯è¿æ¥æµ‹è¯•</h1>
        
        <div class="test-item loading" id="healthTest">
            <h3>å¥åº·æ£€æŸ¥æµ‹è¯•</h3>
            <p>æµ‹è¯• API åŸºç¡€è¿æ¥...</p>
            <button onclick="testHealth()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
            <div id="healthResult"></div>
        </div>
        
        <div class="test-item loading" id="apiTest">
            <h3>API ç«¯ç‚¹æµ‹è¯•</h3>
            <p>æµ‹è¯• API åŠŸèƒ½ç«¯ç‚¹...</p>
            <button onclick="testAPI()">æµ‹è¯•APIç«¯ç‚¹</button>
            <div id="apiResult"></div>
        </div>

        <div class="test-item loading" id="tradingTest">
            <h3>äº¤æ˜“ API æµ‹è¯•</h3>
            <p>æµ‹è¯•äº¤æ˜“ç›¸å…³ç«¯ç‚¹...</p>
            <button onclick="testTradingAPI()">æµ‹è¯•äº¤æ˜“API</button>
            <div id="tradingResult"></div>
        </div>
        
        <div class="test-item loading" id="wsTest">
            <h3>WebSocket è¿æ¥æµ‹è¯•</h3>
            <p>æµ‹è¯•å®æ—¶é€šä¿¡è¿æ¥...</p>
            <button onclick="testWebSocket()">æµ‹è¯•WebSocket</button>
            <div id="wsResult"></div>
        </div>
        
        <div class="test-item">
            <h3>æµ‹è¯•æ—¥å¿—</h3>
            <div id="log" class="log"></div>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <script>
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        async function testHealth() {
            log('å¼€å§‹å¥åº·æ£€æŸ¥æµ‹è¯•...');
            const testDiv = document.getElementById('healthTest');
            const resultDiv = document.getElementById('healthResult');
            
            try {
                const response = await fetch('https://api.aigupiao.me/health');
                const data = await response.json();
                
                if (response.ok) {
                    testDiv.className = 'test-item success';
                    resultDiv.innerHTML = `<strong>âœ… æˆåŠŸ!</strong><br>çŠ¶æ€: ${data.status}<br>æ—¶é—´æˆ³: ${data.timestamp}`;
                    log('å¥åº·æ£€æŸ¥æˆåŠŸ: ' + JSON.stringify(data));
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                testDiv.className = 'test-item error';
                resultDiv.innerHTML = `<strong>âŒ å¤±è´¥!</strong><br>é”™è¯¯: ${error.message}`;
                log('å¥åº·æ£€æŸ¥å¤±è´¥: ' + error.message);
            }
        }

        async function testAPI() {
            log('å¼€å§‹APIç«¯ç‚¹æµ‹è¯•...');
            const testDiv = document.getElementById('apiTest');
            const resultDiv = document.getElementById('apiResult');

            try {
                const response = await fetch('https://api.aigupiao.me/api/test');
                const data = await response.json();

                if (response.ok) {
                    testDiv.className = 'test-item success';
                    resultDiv.innerHTML = `<strong>âœ… æˆåŠŸ!</strong><br>æ¶ˆæ¯: ${data.message}<br>éš§é“çŠ¶æ€: ${data.cloudflare_tunnel}<br>åç«¯çŠ¶æ€: ${data.backend}`;
                    log('APIæµ‹è¯•æˆåŠŸ: ' + JSON.stringify(data));
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                testDiv.className = 'test-item error';
                resultDiv.innerHTML = `<strong>âŒ å¤±è´¥!</strong><br>é”™è¯¯: ${error.message}`;
                log('APIæµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        async function testTradingAPI() {
            log('å¼€å§‹äº¤æ˜“APIæµ‹è¯•...');
            const testDiv = document.getElementById('tradingTest');
            const resultDiv = document.getElementById('tradingResult');

            try {
                // æµ‹è¯•åˆ¸å•†åˆ—è¡¨
                const brokersResponse = await fetch('https://api.aigupiao.me/api/trading/brokers');
                const brokersData = await brokersResponse.json();

                // æµ‹è¯•è´¦æˆ·ä¿¡æ¯
                const accountResponse = await fetch('https://api.aigupiao.me/api/trading/account');
                const accountData = await accountResponse.json();

                // æµ‹è¯•æŒä»“ä¿¡æ¯
                const positionsResponse = await fetch('https://api.aigupiao.me/api/trading/positions');
                const positionsData = await positionsResponse.json();

                if (brokersResponse.ok && accountResponse.ok && positionsResponse.ok) {
                    testDiv.className = 'test-item success';
                    resultDiv.innerHTML = `
                        <strong>âœ… äº¤æ˜“APIæµ‹è¯•æˆåŠŸ!</strong><br>
                        åˆ¸å•†æ•°é‡: ${brokersData.data.length}<br>
                        è´¦æˆ·ä½™é¢: Â¥${accountData.data.balance}<br>
                        æŒä»“æ•°é‡: ${positionsData.data.length}
                    `;
                    log('äº¤æ˜“APIæµ‹è¯•æˆåŠŸ');
                    log('åˆ¸å•†åˆ—è¡¨: ' + JSON.stringify(brokersData));
                    log('è´¦æˆ·ä¿¡æ¯: ' + JSON.stringify(accountData));
                    log('æŒä»“ä¿¡æ¯: ' + JSON.stringify(positionsData));
                } else {
                    throw new Error('äº¤æ˜“APIå“åº”é”™è¯¯');
                }
            } catch (error) {
                testDiv.className = 'test-item error';
                resultDiv.innerHTML = `<strong>âŒ å¤±è´¥!</strong><br>é”™è¯¯: ${error.message}`;
                log('äº¤æ˜“APIæµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        function testWebSocket() {
            log('å¼€å§‹WebSocketè¿æ¥æµ‹è¯•...');
            const testDiv = document.getElementById('wsTest');
            const resultDiv = document.getElementById('wsResult');
            
            try {
                const ws = new WebSocket('wss://api.aigupiao.me/ws');
                
                ws.onopen = function(event) {
                    testDiv.className = 'test-item success';
                    resultDiv.innerHTML = '<strong>âœ… WebSocketè¿æ¥æˆåŠŸ!</strong><br>çŠ¶æ€: å·²è¿æ¥';
                    log('WebSocketè¿æ¥æˆåŠŸ');
                    
                    // å‘é€æµ‹è¯•æ¶ˆæ¯
                    setTimeout(() => {
                        ws.send(JSON.stringify({
                            type: 'test',
                            message: 'Hello from test page',
                            timestamp: new Date().toISOString()
                        }));
                        log('å‘é€æµ‹è¯•æ¶ˆæ¯');
                    }, 1000);
                };
                
                ws.onmessage = function(event) {
                    log('æ”¶åˆ°WebSocketæ¶ˆæ¯: ' + event.data);
                    const currentResult = resultDiv.innerHTML;
                    resultDiv.innerHTML = currentResult + '<br>æ”¶åˆ°æ¶ˆæ¯: ' + event.data.substring(0, 100) + '...';
                };
                
                ws.onclose = function(event) {
                    log('WebSocketè¿æ¥å…³é—­');
                };
                
                ws.onerror = function(error) {
                    testDiv.className = 'test-item error';
                    resultDiv.innerHTML = '<strong>âŒ WebSocketè¿æ¥å¤±è´¥!</strong><br>é”™è¯¯: è¿æ¥å¤±è´¥';
                    log('WebSocketè¿æ¥é”™è¯¯: ' + error);
                };
                
                // 10ç§’åå…³é—­è¿æ¥
                setTimeout(() => {
                    if (ws.readyState === WebSocket.OPEN) {
                        ws.close();
                        log('ä¸»åŠ¨å…³é—­WebSocketè¿æ¥');
                    }
                }, 10000);
                
            } catch (error) {
                testDiv.className = 'test-item error';
                resultDiv.innerHTML = `<strong>âŒ å¤±è´¥!</strong><br>é”™è¯¯: ${error.message}`;
                log('WebSocketæµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æµ‹è¯•
        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡å¼€å§‹è¿æ¥æµ‹è¯•');
            log('æµ‹è¯•ç›®æ ‡: https://api.aigupiao.me');
            
            // è‡ªåŠ¨å¼€å§‹å¥åº·æ£€æŸ¥
            setTimeout(testHealth, 1000);
            // è‡ªåŠ¨å¼€å§‹äº¤æ˜“APIæµ‹è¯•
            setTimeout(testTradingAPI, 3000);
        };
    </script>
</body>
</html>
