"""
Agentè°ƒç”¨ç¤ºä¾‹
æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æ¨¡å—åŒ–çš„äº¤æ˜“API
"""

from trader_api import api

def example_simple_trading():
    """ç®€å•äº¤æ˜“ç¤ºä¾‹"""
    print("ğŸ¤– Agentç¤ºä¾‹: ç®€å•äº¤æ˜“")
    print("-" * 40)
    
    # æŸ¥çœ‹å½“å‰çŠ¶æ€
    status = api.get_status()
    print(f"å½“å‰çª—å£: {status['current_window']}")
    print(f"äº¤æ˜“è½¯ä»¶æ¿€æ´»: {status['trading_software_active']}")
    
    # ä¹°å…¥è‚¡ç¥¨
    print("\nğŸ“ˆ æ‰§è¡Œä¹°å…¥æ“ä½œ...")
    success = api.buy("000001", "100", "10.50")
    print(f"ä¹°å…¥ç»“æœ: {'æˆåŠŸ' if success else 'å¤±è´¥'}")
    
    # å–å‡ºè‚¡ç¥¨
    print("\nğŸ“‰ æ‰§è¡Œå–å‡ºæ“ä½œ...")
    success = api.sell("000001", "50", "10.60")
    print(f"å–å‡ºç»“æœ: {'æˆåŠŸ' if success else 'å¤±è´¥'}")

def example_batch_trading():
    """æ‰¹é‡äº¤æ˜“ç¤ºä¾‹"""
    print("ğŸ¤– Agentç¤ºä¾‹: æ‰¹é‡äº¤æ˜“")
    print("-" * 40)
    
    # å®šä¹‰äº¤æ˜“åˆ—è¡¨
    trades = [
        {"action": "buy", "code": "000001", "quantity": "100", "price": "10.50"},
        {"action": "buy", "code": "600000", "quantity": "200", "price": "å¸‚ä»·"},
        {"action": "sell", "code": "000002", "quantity": "150", "price": "15.80"}
    ]
    
    print("æ‰§è¡Œæ‰¹é‡äº¤æ˜“:")
    for trade in trades:
        print(f"  {trade['action']} {trade['code']} {trade['quantity']}è‚¡ @ {trade['price']}")
    
    # æ‰§è¡Œæ‰¹é‡äº¤æ˜“
    results = api.batch_trade(trades)
    
    print("\näº¤æ˜“ç»“æœ:")
    for result in results:
        trade = result['trade']
        success = result['success']
        status = "âœ…" if success else "âŒ"
        print(f"  {status} {trade['action']} {trade['code']}")

def example_data_export():
    """æ•°æ®å¯¼å‡ºç¤ºä¾‹"""
    print("ğŸ¤– Agentç¤ºä¾‹: æ•°æ®å¯¼å‡º")
    print("-" * 40)
    
    # å¯¼å‡ºæ‰€æœ‰æ•°æ®
    print("å¯¼å‡ºæ‰€æœ‰æ•°æ®...")
    results = api.export_all()
    
    print("å¯¼å‡ºç»“æœ:")
    for data_type, success in results.items():
        status = "âœ…" if success else "âŒ"
        type_name = {"holdings": "æŒä»“", "transactions": "æˆäº¤", "orders": "å§”æ‰˜"}[data_type]
        print(f"  {status} {type_name}æ•°æ®")
    
    # æŸ¥çœ‹å¯¼å‡ºæ–‡ä»¶
    print("\nå¯¼å‡ºæ–‡ä»¶åˆ—è¡¨:")
    files = api.get_files()
    for file_type, file_list in files.items():
        type_name = {"holdings": "æŒä»“", "transactions": "æˆäº¤", "orders": "å§”æ‰˜"}[file_type]
        print(f"  {type_name}: {len(file_list)} ä¸ªæ–‡ä»¶")

def example_file_management():
    """æ–‡ä»¶ç®¡ç†ç¤ºä¾‹"""
    print("ğŸ¤– Agentç¤ºä¾‹: æ–‡ä»¶ç®¡ç†")
    print("-" * 40)
    
    # æŸ¥çœ‹æ–‡ä»¶ç»Ÿè®¡
    files = api.get_files()
    total_files = sum(len(file_list) for file_list in files.values())
    print(f"å½“å‰å…±æœ‰ {total_files} ä¸ªå¯¼å‡ºæ–‡ä»¶")
    
    # æ¸…ç†è¿‡æœŸæ–‡ä»¶
    print("\næ¸…ç†è¿‡æœŸæ–‡ä»¶...")
    api.cleanup_files()
    
    # å†æ¬¡æŸ¥çœ‹æ–‡ä»¶ç»Ÿè®¡
    files_after = api.get_files()
    total_files_after = sum(len(file_list) for file_list in files_after.values())
    print(f"æ¸…ç†åå…±æœ‰ {total_files_after} ä¸ªå¯¼å‡ºæ–‡ä»¶")
    
    if total_files > total_files_after:
        print(f"âœ… æ¸…ç†äº† {total_files - total_files_after} ä¸ªè¿‡æœŸæ–‡ä»¶")
    else:
        print("âœ… æ²¡æœ‰è¿‡æœŸæ–‡ä»¶éœ€è¦æ¸…ç†")

def example_smart_agent():
    """æ™ºèƒ½Agentç¤ºä¾‹"""
    print("ğŸ¤– Agentç¤ºä¾‹: æ™ºèƒ½äº¤æ˜“åŠ©æ‰‹")
    print("-" * 40)
    
    # 1. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
    print("1. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...")
    status = api.get_status()
    
    if not status['trading_software_active']:
        print("âš ï¸ äº¤æ˜“è½¯ä»¶æœªæ¿€æ´»ï¼Œè¯·å…ˆæ‰“å¼€äº¤æ˜“è½¯ä»¶")
        return
    
    # 2. æ¸…ç†è¿‡æœŸæ–‡ä»¶
    print("\n2. æ¸…ç†è¿‡æœŸæ–‡ä»¶...")
    api.cleanup_files()
    
    # 3. å¯¼å‡ºæœ€æ–°æ•°æ®
    print("\n3. å¯¼å‡ºæœ€æ–°æ•°æ®...")
    export_results = api.export_all()
    
    # 4. æ ¹æ®å¯¼å‡ºç»“æœå†³å®šæ˜¯å¦è¿›è¡Œäº¤æ˜“
    if all(export_results.values()):
        print("\n4. æ•°æ®å¯¼å‡ºæˆåŠŸï¼Œå¯ä»¥è¿›è¡Œäº¤æ˜“...")
        
        # ç¤ºä¾‹äº¤æ˜“å†³ç­–é€»è¾‘
        trades = [
            {"action": "buy", "code": "000001", "quantity": "100", "price": "å¸‚ä»·"}
        ]
        
        print("æ‰§è¡Œæ™ºèƒ½äº¤æ˜“...")
        trade_results = api.batch_trade(trades)
        
        success_count = sum(1 for r in trade_results if r['success'])
        print(f"âœ… å®Œæˆ {success_count}/{len(trades)} ç¬”äº¤æ˜“")
        
    else:
        print("\n4. æ•°æ®å¯¼å‡ºå¤±è´¥ï¼Œè·³è¿‡äº¤æ˜“æ“ä½œ")
    
    # 5. ç”ŸæˆæŠ¥å‘Š
    print("\n5. ç”Ÿæˆæ“ä½œæŠ¥å‘Š...")
    final_status = api.get_status()
    files = final_status['export_files']
    
    print("ğŸ“Š æ“ä½œæ€»ç»“:")
    print(f"  - å¯¼å‡ºæ–‡ä»¶: {sum(files.values())} ä¸ª")
    print(f"  - æŒä»“æ•°æ®: {files['holdings_count']} ä¸ª")
    print(f"  - æˆäº¤æ•°æ®: {files['transactions_count']} ä¸ª")
    print(f"  - å§”æ‰˜æ•°æ®: {files['orders_count']} ä¸ª")

def main():
    """ä¸»å‡½æ•°"""
    print("ğŸ¯ äº¤æ˜“APIä½¿ç”¨ç¤ºä¾‹")
    print("=" * 50)
    
    examples = [
        ("1", "ç®€å•äº¤æ˜“", example_simple_trading),
        ("2", "æ‰¹é‡äº¤æ˜“", example_batch_trading),
        ("3", "æ•°æ®å¯¼å‡º", example_data_export),
        ("4", "æ–‡ä»¶ç®¡ç†", example_file_management),
        ("5", "æ™ºèƒ½Agent", example_smart_agent)
    ]
    
    print("é€‰æ‹©ç¤ºä¾‹:")
    for num, name, _ in examples:
        print(f"  {num}. {name}")
    print("  0. é€€å‡º")
    
    choice = input("\nè¯·é€‰æ‹© (0-5): ").strip()
    
    for num, name, func in examples:
        if choice == num:
            print(f"\n{'='*20} {name} {'='*20}")
            func()
            break
    else:
        if choice == "0":
            print("ğŸ‘‹ é€€å‡ºç¤ºä¾‹")
        else:
            print("âŒ æ— æ•ˆé€‰æ‹©")

if __name__ == "__main__":
    main()
