<template>
	<view class="container" :class="isDarkMode ? 'dark-theme' : 'light-theme'">
		<view class="header">
			<view class="title">Agentæ™ºèƒ½é¢„æµ‹</view>
			<view class="subtitle">åŸºäºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„å¸‚åœºè¡Œæƒ…é¢„æµ‹</view>
		</view>
		
		<!-- è‚¡ç¥¨é€‰æ‹© -->
		<view class="card">
			<view class="stock-selector">
				<view class="search-wrapper">
					<input type="text" v-model="searchText" placeholder="è¯·è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°" class="search-input" @input="onSearchInput" />
					<view class="search-icon">
						<text class="icon-search">ğŸ”</text>
					</view>
				</view>
				
				<!-- æœç´¢ç»“æœä¸‹æ‹‰æ¡† -->
				<view class="search-results" v-if="showSearchResults && searchResults.length > 0">
					<view v-for="(stock, index) in searchResults" :key="index" class="result-item" @click="selectStock(stock)">
						<view class="stock-code-name">
							<text class="stock-code">{{stock.code}}</text>
							<text class="stock-name">{{stock.name}}</text>
						</view>
						<text class="stock-price">{{stock.price}}</text>
					</view>
				</view>
			</view>
			
			<!-- å·²é€‰è‚¡ç¥¨ä¿¡æ¯ -->
			<view class="selected-stock" v-if="selectedStock">
				<view class="stock-info">
					<view class="stock-name-code">
						<text class="stock-name-large">{{selectedStock.name}}</text>
						<text class="stock-code-large">{{selectedStock.code}}</text>
					</view>
					<view class="stock-price-change">
						<text class="stock-price-large" :class="{'price-up': selectedStock.priceChange > 0, 'price-down': selectedStock.priceChange < 0}">
							{{selectedStock.price}}
						</text>
						<view class="price-change" :class="{'price-up': selectedStock.priceChange > 0, 'price-down': selectedStock.priceChange < 0}">
							<text>{{selectedStock.priceChange > 0 ? '+' : ''}}{{selectedStock.priceChange}}</text>
							<text>({{selectedStock.priceChangePercent}}%)</text>
						</view>
					</view>
				</view>
				
				<view class="time-range-selector">
					<view v-for="(option, index) in timeRangeOptions" :key="index" 
						class="time-option" :class="{'active': selectedTimeRange === option.value}"
						@click="selectTimeRange(option.value)">
						{{option.label}}
					</view>
				</view>
			</view>
		</view>
		
		<!-- ä»·æ ¼é¢„æµ‹å›¾è¡¨ -->
		<view class="card" v-if="selectedStock && pricePrediction">
			<view class="card-title">
				<text>ä»·æ ¼é¢„æµ‹ ({{timeRangeLabels[selectedTimeRange]}})</text>
				<view class="confidence-level">
					<text>ç½®ä¿¡åº¦: {{pricePrediction.confidence}}%</text>
				</view>
			</view>
			
			<view class="chart-container">
				<view class="chart-placeholder">
					<!-- å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šä½¿ç”¨echartsæˆ–å…¶ä»–å›¾è¡¨åº“ -->
					<text class="chart-text">ä»·æ ¼é¢„æµ‹å›¾è¡¨</text>
				</view>
				
				<view class="prediction-summary">
					<view class="prediction-item" :class="{'prediction-up': predictionTrend > 0, 'prediction-down': predictionTrend < 0}">
						<text class="prediction-value">{{predictionEndValue}}</text>
						<text class="prediction-label">{{timeRangeLabels[selectedTimeRange]}}é¢„æµ‹ä»·</text>
					</view>
					<view class="prediction-item" :class="{'prediction-up': predictionTrend > 0, 'prediction-down': predictionTrend < 0}">
						<text class="prediction-value">{{predictionTrend > 0 ? '+' : ''}}{{predictionTrend}}%</text>
						<text class="prediction-label">é¢„æœŸå˜åŠ¨</text>
					</view>
					<view class="prediction-range">
						<text class="range-label">é¢„æµ‹åŒºé—´:</text>
						<text class="range-value">{{pricePrediction.lowerBound}} - {{pricePrediction.upperBound}}</text>
					</view>
				</view>
			</view>
		</view>
		
		<!-- å…³é”®æŒ‡æ ‡é¢„æµ‹ -->
		<view class="card" v-if="selectedStock">
			<view class="card-title">
				<text>å…³é”®æŒ‡æ ‡é¢„æµ‹</text>
			</view>
			
			<view class="metrics-grid">
				<view v-for="(metric, index) in keyMetrics" :key="index" class="metric-card">
					<view class="metric-header">
						<text class="metric-name">{{metric.name}}</text>
						<view class="metric-trend" :class="{'trend-up': metric.trend > 0, 'trend-down': metric.trend < 0, 'trend-flat': metric.trend === 0}">
							<text class="trend-icon">{{metric.trend > 0 ? 'â†‘' : metric.trend < 0 ? 'â†“' : 'â€”'}}</text>
							<text class="trend-value">{{metric.trend > 0 ? '+' : ''}}{{metric.trend}}%</text>
						</view>
					</view>
					<view class="metric-value">{{metric.value}}</view>
					<view class="metric-desc">{{metric.description}}</view>
				</view>
			</view>
		</view>
		
		<!-- è¡Œæƒ…é¢„åˆ¤ -->
		<view class="card" v-if="selectedStock">
			<view class="card-title">
				<text>è¡Œæƒ…é¢„åˆ¤</text>
				<view class="date-info">
					<text>æ•°æ®æ›´æ–°: {{lastUpdateTime}}</text>
				</view>
			</view>
			
			<view class="market-outlook">
				<view class="outlook-section">
					<view class="outlook-header">
						<text class="outlook-title">å¸‚åœºæƒ…ç»ª</text>
						<view class="sentiment-indicator" :class="getSentimentClass(marketSentiment)">
							<text>{{getSentimentText(marketSentiment)}}</text>
						</view>
					</view>
					<view class="outlook-content">{{marketSentimentDesc}}</view>
				</view>
				
				<view class="outlook-section">
					<view class="outlook-header">
						<text class="outlook-title">æ”¯æ’‘/é˜»åŠ›ä½</text>
					</view>
					<view class="levels-container">
						<view class="resistance-levels">
							<view v-for="(level, index) in resistanceLevels" :key="'r'+index" class="level-item resistance">
								<text class="level-value">{{level.value}}</text>
								<text class="level-strength">{{level.strength}}</text>
							</view>
						</view>
						<view class="current-price-line">
							<text class="current-price-marker">{{selectedStock.price}}</text>
						</view>
						<view class="support-levels">
							<view v-for="(level, index) in supportLevels" :key="'s'+index" class="level-item support">
								<text class="level-value">{{level.value}}</text>
								<text class="level-strength">{{level.strength}}</text>
							</view>
						</view>
					</view>
				</view>
				
				<view class="outlook-section">
					<view class="outlook-header">
						<text class="outlook-title">å…³é”®å› ç´ </text>
					</view>
					<view class="factors-list">
						<view v-for="(factor, index) in keyFactors" :key="index" class="factor-item">
							<view class="factor-icon" :class="factor.impact">
								<text>{{factor.impact === 'positive' ? 'â†‘' : factor.impact === 'negative' ? 'â†“' : 'â€”'}}</text>
							</view>
							<view class="factor-content">
								<text class="factor-name">{{factor.name}}</text>
								<text class="factor-desc">{{factor.description}}</text>
							</view>
						</view>
					</view>
				</view>
			</view>
		</view>
		
		<!-- é¢„æµ‹æ€§èƒ½è¯„ä¼° -->
		<view class="card" v-if="selectedStock">
			<view class="card-title">
				<text>é¢„æµ‹æ€§èƒ½</text>
			</view>
			
			<view class="performance-stats">
				<view class="performance-item">
					<text class="performance-value">{{predictionAccuracy}}%</text>
					<text class="performance-label">é¢„æµ‹å‡†ç¡®ç‡</text>
				</view>
				<view class="performance-item">
					<text class="performance-value">{{predictionMae}}</text>
					<text class="performance-label">å¹³å‡ç»å¯¹è¯¯å·®</text>
				</view>
				<view class="performance-item">
					<text class="performance-value">{{successfulPredictions}}/{{totalPredictions}}</text>
					<text class="performance-label">æ–¹å‘é¢„æµ‹</text>
				</view>
			</view>
			
			<view class="historical-accuracy">
				<view class="accuracy-header">
					<text>å†å²é¢„æµ‹è¡¨ç°</text>
				</view>
				<view class="accuracy-chart-placeholder">
					<!-- å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šä½¿ç”¨echartsæˆ–å…¶ä»–å›¾è¡¨åº“ -->
					<text class="chart-text">å†å²å‡†ç¡®ç‡å›¾è¡¨</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
import aiService from '../../services/aiService.js';

export default {
	data() {
		return {
			searchText: '',
			selectedStock: null,
			showSearchResults: false,
			searchResults: [],
			isDarkMode: false, // ä½¿ç”¨ä¸è®¾ç½®é¡µé¢ç›¸åŒçš„æ–¹å¼
			timeRangeOptions: [
				{ label: '1å¤©', value: 'day' },
				{ label: '1å‘¨', value: 'week' },
				{ label: '1æœˆ', value: 'month' },
				{ label: '3æœˆ', value: 'quarter' }
			],
			timeRangeLabels: {
				'day': '1å¤©å',
				'week': '1å‘¨å',
				'month': '1æœˆå',
				'quarter': '3æœˆå'
			},
			selectedTimeRange: 'week',
			pricePrediction: null,
			keyMetrics: [],
			marketSentiment: 0, // -100 åˆ° 100
			marketSentimentDesc: '',
			resistanceLevels: [],
			supportLevels: [],
			keyFactors: [],
			predictionAccuracy: 0,
			predictionMae: 0,
			successfulPredictions: 0,
			totalPredictions: 0,
			lastUpdateTime: '',
			loading: false
		};
	},
	
	computed: {
		// è®¡ç®—é¢„æµ‹ä»·æ ¼è¶‹åŠ¿ç™¾åˆ†æ¯”
		predictionTrend() {
			if (!this.selectedStock || !this.pricePrediction) return 0;
			
			const currentPrice = parseFloat(this.selectedStock.price);
			const predictedPrice = parseFloat(this.pricePrediction.endValue);
			
			return parseFloat(((predictedPrice - currentPrice) / currentPrice * 100).toFixed(2));
		},
		
		// è·å–é¢„æµ‹æœ€ç»ˆä»·æ ¼
		predictionEndValue() {
			if (!this.pricePrediction) return '';
			return this.pricePrediction.endValue;
		}
	},
	
	onLoad() {
		// ä½¿ç”¨å…¨å±€ä¸»é¢˜è®¾ç½®
		const app = getApp();
		if (app.globalData) {
			this.isDarkMode = app.globalData.isDarkMode;
		}
		
		// ç›‘å¬ä¸»é¢˜å˜åŒ–äº‹ä»¶
		uni.$on('theme-changed', this.updateThemeFromGlobal);
		
		// æŸ¥è¯¢ä¸Šæ¬¡é€‰æ‹©çš„è‚¡ç¥¨
		this.getLastSelectedStock();
		// è·å–é¢„æµ‹æ€§èƒ½
		this.fetchPredictionPerformance();
	},
	
	onUnload() {
		// ç§»é™¤ä¸»é¢˜å˜åŒ–ç›‘å¬
		uni.$off('theme-changed', this.updateThemeFromGlobal);
	},
	
	onShow() {
		// æ¯æ¬¡æ˜¾ç¤ºé¡µé¢æ—¶åŒæ­¥å…¨å±€ä¸»é¢˜è®¾ç½®
		this.updateThemeFromGlobal();
	},
	
	methods: {
		// æ›´æ–°ä¸»é¢˜æ¥è‡ªå…¨å±€è®¾ç½®
		updateThemeFromGlobal() {
			const app = getApp();
			if (app.globalData) {
				this.isDarkMode = app.globalData.isDarkMode;
			}
		},
		
		// å¤„ç†æœç´¢è¾“å…¥
		onSearchInput() {
			if (this.searchText.trim() === '') {
				this.showSearchResults = false;
				this.searchResults = [];
				return;
			}
			
			// è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„è‚¡ç¥¨æœç´¢API
			// ä¸ºäº†æ¼”ç¤ºï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
			this.mockSearchResults();
		},
		
		// æ¨¡æ‹Ÿæœç´¢ç»“æœ
		mockSearchResults() {
			this.searchResults = [
				{ code: '600519', name: 'è´µå·èŒ…å°', price: '1832.00', priceChange: 24.5, priceChangePercent: 1.35 },
				{ code: '601318', name: 'ä¸­å›½å¹³å®‰', price: '41.23', priceChange: -0.52, priceChangePercent: -1.24 },
				{ code: '000858', name: 'äº”ç²®æ¶²', price: '168.75', priceChange: 3.25, priceChangePercent: 1.96 },
				{ code: '600036', name: 'æ‹›å•†é“¶è¡Œ', price: '35.87', priceChange: 0.15, priceChangePercent: 0.42 }
			];
			this.showSearchResults = true;
		},
		
		// é€‰æ‹©è‚¡ç¥¨
		selectStock(stock) {
			this.selectedStock = stock;
			this.showSearchResults = false;
			this.searchText = `${stock.code} ${stock.name}`;
			
			// è·å–é¢„æµ‹æ•°æ®
			this.fetchPredictionData();
		},
		
		// é€‰æ‹©æ—¶é—´èŒƒå›´
		selectTimeRange(range) {
			this.selectedTimeRange = range;
			
			// é‡æ–°è·å–é¢„æµ‹æ•°æ®
			this.fetchPredictionData();
		},
		
		// è·å–ä»·æ ¼é¢„æµ‹å’Œç›¸å…³æ•°æ®
		async fetchPredictionData() {
			try {
				this.loading = true;
				uni.showLoading({
					title: 'è·å–é¢„æµ‹æ•°æ®...'
				});
				
				// è½¬æ¢æ—¶é—´èŒƒå›´ä¸ºå¤©æ•°
				const timeStepsMap = {
					'day': 1,
					'week': 5,
					'month': 20,
					'quarter': 60
				};
				
				// è·å–ä»·æ ¼é¢„æµ‹
				const priceData = await aiService.getPricePrediction(
					this.selectedStock.code,
					timeStepsMap[this.selectedTimeRange]
				);
				
				// å¤„ç†ä»·æ ¼é¢„æµ‹æ•°æ®
				this.processPricePrediction(priceData);
				
				// è·å–å¸‚åœºæƒ…ç»ªå’Œæ”¯æ’‘é˜»åŠ›ä½
				this.fetchMarketOutlook();
				
				// è·å–å…³é”®æŒ‡æ ‡é¢„æµ‹
				this.fetchKeyMetrics();
				
				// è·å–é¢„æµ‹æ€§èƒ½æŒ‡æ ‡
				this.fetchPredictionPerformance();
				
				uni.hideLoading();
			} catch (err) {
				uni.hideLoading();
				console.error('è·å–é¢„æµ‹æ•°æ®å¤±è´¥:', err);
				uni.showToast({
					title: 'è·å–é¢„æµ‹æ•°æ®å¤±è´¥',
					icon: 'none'
				});
			} finally {
				this.loading = false;
			}
		},
		
		// å¤„ç†ä»·æ ¼é¢„æµ‹æ•°æ®
		processPricePrediction(data) {
			// åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™é‡Œä¼šå¤„ç†åç«¯è¿”å›çš„ä»·æ ¼é¢„æµ‹æ•°æ®
			// è¿™é‡Œç›´æ¥ç”¨æ¨¡æ‹Ÿæ•°æ®
			
			// è®¡ç®—æœ€ç»ˆé¢„æµ‹ä»·æ ¼
			const predictions = data.predictions || [];
			const lastPrediction = predictions[predictions.length - 1] || {};
			
			this.pricePrediction = {
				startValue: this.selectedStock.price,
				endValue: lastPrediction.predicted_price ? lastPrediction.predicted_price.toFixed(2) : (parseFloat(this.selectedStock.price) * 1.05).toFixed(2),
				trend: this.predictionTrend,
				lowerBound: lastPrediction.lower_bound ? lastPrediction.lower_bound.toFixed(2) : (parseFloat(this.selectedStock.price) * 0.98).toFixed(2),
				upperBound: lastPrediction.upper_bound ? lastPrediction.upper_bound.toFixed(2) : (parseFloat(this.selectedStock.price) * 1.12).toFixed(2),
				confidence: lastPrediction.confidence ? Math.round(lastPrediction.confidence * 100) : 95,
				data: predictions
			};
		},
		
		// è·å–å¸‚åœºå‰æ™¯å’Œæ”¯æ’‘é˜»åŠ›ä½
		async fetchMarketOutlook() {
			try {
				// è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„API
				// ä¸ºäº†æ¼”ç¤ºï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
				
				// æ¨¡æ‹Ÿå¸‚åœºæƒ…ç»ª (-100 åˆ° 100)
				this.marketSentiment = Math.floor(Math.random() * 140) - 70;
				
				// å¸‚åœºæƒ…ç»ªæè¿°
				if (this.marketSentiment >= 50) {
					this.marketSentimentDesc = 'å¸‚åœºæƒ…ç»ªé«˜æ¶¨ï¼ŒæŠ•èµ„è€…æ™®éçœ‹å¥½è¯¥è‚¡çŸ­æœŸè¡¨ç°ã€‚å„å¤§æœºæ„è¿‘æœŸæŒç»­å¢æŒï¼Œæ•£æˆ·è·Ÿé£æ˜æ˜¾ã€‚';
				} else if (this.marketSentiment >= 0) {
					this.marketSentimentDesc = 'å¸‚åœºæƒ…ç»ªä¸­æ€§åä¹è§‚ï¼ŒæŠ•èµ„è€…å¯¹è¯¥è‚¡çœ‹æ³•åˆ†æ­§ä¸å¤§ã€‚ä¸»åŠ›èµ„é‡‘æ€åº¦è§‚æœ›ï¼Œæ•£æˆ·è·Ÿé£æƒ…ç»ªä¸é«˜ã€‚';
				} else if (this.marketSentiment >= -50) {
					this.marketSentimentDesc = 'å¸‚åœºæƒ…ç»ªä¸­æ€§åè°¨æ…ï¼ŒæŠ•èµ„è€…å¯¹è¯¥è‚¡æœªæ¥èµ°åŠ¿å­˜æœ‰ç–‘è™‘ã€‚ä¸»åŠ›èµ„é‡‘æœ‰å°å¹…æµå‡ºï¼Œæ•£æˆ·æŒå¸è§‚æœ›ã€‚';
				} else {
					this.marketSentimentDesc = 'å¸‚åœºæƒ…ç»ªä½è¿·ï¼ŒæŠ•èµ„è€…å¯¹è¯¥è‚¡å‰æ™¯æ™®éæ‚²è§‚ã€‚ä¸»åŠ›èµ„é‡‘æŒç»­æµå‡ºï¼Œæ•£æˆ·ææ…Œæƒ…ç»ªåŠ å‰§ã€‚';
				}
				
				// æ¨¡æ‹Ÿé˜»åŠ›ä½æ•°æ®
				const basePrice = parseFloat(this.selectedStock.price);
				this.resistanceLevels = [
					{ value: (basePrice * 1.03).toFixed(2), strength: 'å¼±' },
					{ value: (basePrice * 1.05).toFixed(2), strength: 'ä¸­' },
					{ value: (basePrice * 1.08).toFixed(2), strength: 'å¼º' }
				];
				
				// æ¨¡æ‹Ÿæ”¯æ’‘ä½æ•°æ®
				this.supportLevels = [
					{ value: (basePrice * 0.97).toFixed(2), strength: 'å¼±' },
					{ value: (basePrice * 0.95).toFixed(2), strength: 'ä¸­' },
					{ value: (basePrice * 0.92).toFixed(2), strength: 'å¼º' }
				];
				
				// æ¨¡æ‹Ÿå…³é”®å› ç´ 
				this.keyFactors = [
					{
						name: 'å­£æŠ¥ä¸šç»©è¶…é¢„æœŸ',
						description: 'å…¬å¸ç¬¬ä¸‰å­£åº¦å‡€åˆ©æ¶¦åŒæ¯”å¢é•¿22.5%ï¼Œè¶…å‡ºå¸‚åœºé¢„æœŸçš„18.3%',
						impact: 'positive'
					},
					{
						name: 'å¤–èµ„æŒç»­æµå…¥',
						description: 'è¿‘20ä¸ªäº¤æ˜“æ—¥å¤–èµ„å‡€æµå…¥3.2äº¿å…ƒï¼ŒæŒä»“æ¯”ä¾‹ä¸Šå‡0.4%',
						impact: 'positive'
					},
					{
						name: 'è¡Œä¸šæ”¿ç­–è°ƒæ§',
						description: 'æœ€æ–°è¡Œä¸šç›‘ç®¡æ”¿ç­–æˆ–å°†é™åˆ¶å…¬å¸éƒ¨åˆ†é«˜åˆ©æ¶¦ä¸šåŠ¡çš„æ‰©å¼ ',
						impact: 'negative'
					},
					{
						name: 'å¸‚åœºæ³¢åŠ¨åŠ å‰§',
						description: 'å¤§ç›˜æ³¢åŠ¨ç‡è¿‘æœŸæ˜¾è‘—æé«˜ï¼Œå¢åŠ ç³»ç»Ÿæ€§é£é™©',
						impact: 'neutral'
					}
				];
				
				// æ›´æ–°æ—¶é—´
				const now = new Date();
				this.lastUpdateTime = `${now.getMonth()+1}æœˆ${now.getDate()}æ—¥ ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
				
			} catch (err) {
				console.error('è·å–å¸‚åœºå‰æ™¯æ•°æ®å¤±è´¥:', err);
			}
		},
		
		// è·å–å…³é”®æŒ‡æ ‡é¢„æµ‹
		async fetchKeyMetrics() {
			try {
				// è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„API
				// ä¸ºäº†æ¼”ç¤ºï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
				this.keyMetrics = [
					{
						name: 'å¸‚ç›ˆç‡(P/E)',
						value: '18.6',
						trend: 2.5,
						description: 'ä¼°å€¼æ°´å¹³ç›¸æ¯”è¡Œä¸šå¹³å‡ä½10%ï¼Œå…·æœ‰ä¸€å®šå®‰å…¨è¾¹é™…'
					},
					{
						name: 'æ”¶å…¥å¢é•¿',
						value: '15.8%',
						trend: 3.2,
						description: 'è¥æ”¶å¢é€ŸæŒç»­é«˜äºè¡Œä¸šæ°´å¹³ï¼Œå¸‚åœºä»½é¢ç¨³æ­¥æå‡'
					},
					{
						name: 'å‡€åˆ©æ¶¦ç‡',
						value: '12.4%',
						trend: -1.8,
						description: 'åŸææ–™æˆæœ¬ä¸Šå‡å¯¼è‡´åˆ©æ¶¦ç‡å°å¹…ä¸‹æ»‘ï¼Œä½†ä»å¤„äºå¥åº·æ°´å¹³'
					},
					{
						name: 'èµ„äº§è´Ÿå€ºç‡',
						value: '42.5%',
						trend: 0,
						description: 'è´¢åŠ¡ç»“æ„ç¨³å¥ï¼Œé•¿æœŸå€ºåŠ¡æ¯”ä¾‹ä¸‹é™ï¼ŒæµåŠ¨æ€§å……è¶³'
					}
				];
			} catch (err) {
				console.error('è·å–å…³é”®æŒ‡æ ‡é¢„æµ‹å¤±è´¥:', err);
			}
		},
		
		// è·å–é¢„æµ‹æ€§èƒ½æŒ‡æ ‡
		async fetchPredictionPerformance() {
			try {
				// è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„API
				// ä¸ºäº†æ¼”ç¤ºï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
				this.predictionAccuracy = 87.6;
				this.predictionMae = 0.62;
				this.successfulPredictions = 17;
				this.totalPredictions = 20;
			} catch (err) {
				console.error('è·å–é¢„æµ‹æ€§èƒ½æŒ‡æ ‡å¤±è´¥:', err);
			}
		},
		
		// è·å–å¸‚åœºæƒ…ç»ªç­‰çº§æ ·å¼
		getSentimentClass(value) {
			if (value >= 50) return 'sentiment-bullish';
			if (value >= 0) return 'sentiment-slightly-bullish';
			if (value >= -50) return 'sentiment-slightly-bearish';
			return 'sentiment-bearish';
		},
		
		// è·å–å¸‚åœºæƒ…ç»ªæ–‡æœ¬
		getSentimentText(value) {
			if (value >= 50) return 'å¼ºçƒˆçœ‹å¤š';
			if (value >= 0) return 'è°¨æ…çœ‹å¤š';
			if (value >= -50) return 'è°¨æ…çœ‹ç©º';
			return 'å¼ºçƒˆçœ‹ç©º';
		},
		
		// è·å–ä¸Šä¸€æ¬¡é€‰æ‹©çš„è‚¡ç¥¨
		getLastSelectedStock() {
			try {
				// å°è¯•ä»æœ¬åœ°å­˜å‚¨è·å–ä¸Šæ¬¡é€‰æ‹©çš„è‚¡ç¥¨
				const lastStock = uni.getStorageSync('last_selected_stock');
				if (lastStock) {
					this.selectedStock = JSON.parse(lastStock);
					this.searchText = `${this.selectedStock.code} ${this.selectedStock.name}`;
					
					// è·å–é¢„æµ‹æ•°æ®
					this.fetchPredictionData();
				} else {
					// æ²¡æœ‰æ‰¾åˆ°ä¸Šæ¬¡é€‰æ‹©çš„è‚¡ç¥¨ï¼Œä½¿ç”¨é»˜è®¤è‚¡ç¥¨
					this.selectedStock = {
						code: '600519',
						name: 'è´µå·èŒ…å°',
						price: '1832.00',
						priceChange: 24.5,
						priceChangePercent: 1.35
					};
					this.searchText = `${this.selectedStock.code} ${this.selectedStock.name}`;
					
					// è·å–é¢„æµ‹æ•°æ®
					this.fetchPredictionData();
					
					// æ˜¾ç¤ºæç¤º
					uni.showToast({
						title: 'å·²åŠ è½½é»˜è®¤è‚¡ç¥¨æ•°æ®',
						icon: 'none',
						duration: 2000
					});
				}
			} catch (error) {
				console.error('è·å–ä¸Šæ¬¡é€‰æ‹©çš„è‚¡ç¥¨å¤±è´¥:', error);
				
				// å‡ºé”™æ—¶ä½¿ç”¨é»˜è®¤è‚¡ç¥¨
				this.selectedStock = {
					code: '600519',
					name: 'è´µå·èŒ…å°',
					price: '1832.00',
					priceChange: 24.5,
					priceChangePercent: 1.35
				};
				this.searchText = `${this.selectedStock.code} ${this.selectedStock.name}`;
				
				// è·å–é¢„æµ‹æ•°æ®
				this.fetchPredictionData();
			}
		}
	}
};
</script>

<style>
.container {
	padding: 30rpx;
	min-height: 100vh;
}

/* ä¸»é¢˜æ ·å¼ */
.dark-theme {
	background-color: #141414;
	color: #e0e0e0;
}

.light-theme {
	background-color: #f5f5f5;
	color: #333333;
}

.dark-theme .card {
	background-color: #222222;
	border-radius: 12rpx;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.3);
	margin-bottom: 20rpx;
}

.light-theme .card {
	background-color: #ffffff;
	border-radius: 12rpx;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);
	margin-bottom: 20rpx;
}

/* å¤´éƒ¨æ ·å¼ */
.header {
	margin-bottom: 20rpx;
}

.title {
	font-size: 40rpx;
	font-weight: bold;
	margin-bottom: 10rpx;
}

.subtitle {
	font-size: 26rpx;
	color: #999;
}

/* å¡ç‰‡æ ·å¼ */
.card {
	padding: 20rpx;
	margin-bottom: 20rpx;
}

.card-title {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 20rpx;
	font-size: 32rpx;
	font-weight: bold;
}

/* è‚¡ç¥¨é€‰æ‹©æ ·å¼ */
.stock-selector {
	position: relative;
	margin-bottom: 20rpx;
}

.search-wrapper {
	position: relative;
	margin-bottom: 10rpx;
}

.search-input {
	height: 80rpx;
	border-radius: 8rpx;
	padding: 0 70rpx 0 20rpx;
	font-size: 28rpx;
	width: 100%;
	box-sizing: border-box;
}

.dark-theme .search-input {
	background-color: #333;
	color: #fff;
	border: 1px solid #444;
}

.light-theme .search-input {
	background-color: #f5f5f5;
	color: #333;
	border: 1px solid #ddd;
}

.search-icon {
	position: absolute;
	right: 20rpx;
	top: 20rpx;
	font-size: 32rpx;
	color: #999;
}

.search-results {
	position: absolute;
	left: 0;
	right: 0;
	top: 90rpx;
	border-radius: 8rpx;
	z-index: 100;
	max-height: 400rpx;
	overflow-y: auto;
}

.dark-theme .search-results {
	background-color: #333;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.3);
}

.light-theme .search-results {
	background-color: #fff;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);
}

.result-item {
	display: flex;
	justify-content: space-between;
	padding: 20rpx;
	border-bottom: 1px solid #444;
	cursor: pointer;
}

.dark-theme .result-item {
	border-bottom: 1px solid #444;
}

.light-theme .result-item {
	border-bottom: 1px solid #eee;
}

.result-item:last-child {
	border-bottom: none;
}

.dark-theme .result-item:active {
	background-color: #444;
}

.light-theme .result-item:active {
	background-color: #f0f0f0;
}

.stock-code-name {
	display: flex;
	flex-direction: column;
}

.stock-code {
	font-size: 26rpx;
	font-weight: bold;
	margin-bottom: 5rpx;
}

.stock-name {
	font-size: 24rpx;
	color: #999;
}

.stock-price {
	font-size: 28rpx;
	font-weight: bold;
}

/* å·²é€‰è‚¡ç¥¨æ ·å¼ */
.selected-stock {
	margin-top: 20rpx;
}

.stock-info {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 20rpx;
}

.stock-name-code {
	display: flex;
	flex-direction: column;
}

.stock-name-large {
	font-size: 32rpx;
	font-weight: bold;
	margin-bottom: 5rpx;
}

.stock-code-large {
	font-size: 26rpx;
	color: #999;
}

.stock-price-change {
	display: flex;
	flex-direction: column;
	align-items: flex-end;
}

.stock-price-large {
	font-size: 36rpx;
	font-weight: bold;
	margin-bottom: 5rpx;
}

.price-change {
	display: flex;
	font-size: 24rpx;
}

.price-up {
	color: #f5222d;
}

.price-down {
	color: #52c41a;
}

/* æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ */
.time-range-selector {
	display: flex;
	justify-content: space-between;
	margin-top: 20rpx;
}

.time-option {
	flex: 1;
	text-align: center;
	padding: 15rpx 0;
	font-size: 28rpx;
	border-radius: 6rpx;
	margin: 0 5rpx;
	cursor: pointer;
}

.dark-theme .time-option {
	background-color: #333;
}

.light-theme .time-option {
	background-color: #f0f0f0;
}

.time-option.active {
	background-color: #4c8dff;
	color: #fff;
}

/* ç½®ä¿¡åº¦ */
.confidence-level {
	font-size: 24rpx;
	color: #999;
	background-color: rgba(76, 141, 255, 0.1);
	padding: 5rpx 15rpx;
	border-radius: 20rpx;
}

/* é¢„æµ‹å›¾è¡¨ */
.chart-container {
	margin-top: 20rpx;
}

.chart-placeholder {
	height: 350rpx;
	display: flex;
	justify-content: center;
	align-items: center;
	border-radius: 8rpx;
	margin-bottom: 20rpx;
}

.dark-theme .chart-placeholder {
	background-color: #333;
}

.light-theme .chart-placeholder {
	background-color: #f0f0f0;
}

.chart-text {
	font-size: 28rpx;
	color: #999;
}

.prediction-summary {
	display: flex;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
}

.prediction-item {
	display: flex;
	flex-direction: column;
	align-items: center;
	margin-bottom: 15rpx;
	width: 40%;
}

.prediction-value {
	font-size: 36rpx;
	font-weight: bold;
	margin-bottom: 5rpx;
}

.prediction-label {
	font-size: 24rpx;
	color: #999;
}

.prediction-up .prediction-value {
	color: #f5222d;
}

.prediction-down .prediction-value {
	color: #52c41a;
}

.prediction-range {
	width: 100%;
	text-align: center;
	margin-top: 10rpx;
	font-size: 24rpx;
}

.range-label {
	color: #999;
	margin-right: 10rpx;
}

/* å…³é”®æŒ‡æ ‡æ ·å¼ */
.metrics-grid {
	display: flex;
	flex-wrap: wrap;
	margin: 0 -10rpx;
}

.metric-card {
	width: 50%;
	padding: 10rpx;
	box-sizing: border-box;
	margin-bottom: 20rpx;
}

.metric-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 10rpx;
}

.metric-name {
	font-size: 26rpx;
	font-weight: bold;
}

.metric-trend {
	display: flex;
	align-items: center;
	font-size: 22rpx;
}

.trend-icon {
	margin-right: 5rpx;
}

.trend-up {
	color: #f5222d;
}

.trend-down {
	color: #52c41a;
}

.trend-flat {
	color: #999;
}

.metric-value {
	font-size: 32rpx;
	font-weight: bold;
	margin-bottom: 5rpx;
}

.metric-desc {
	font-size: 22rpx;
	line-height: 1.3;
}

.dark-theme .metric-desc {
	color: #999;
}

.light-theme .metric-desc {
	color: #666;
}

/* è¡Œæƒ…é¢„åˆ¤æ ·å¼ */
.date-info {
	font-size: 22rpx;
	color: #999;
}

.market-outlook {
	margin-top: 10rpx;
}

.outlook-section {
	margin-bottom: 30rpx;
}

.outlook-header {
	display: flex;
	align-items: center;
	margin-bottom: 15rpx;
}

.outlook-title {
	font-size: 28rpx;
	font-weight: bold;
	margin-right: 15rpx;
}

.sentiment-indicator {
	font-size: 24rpx;
	padding: 5rpx 15rpx;
	border-radius: 20rpx;
}

.sentiment-bullish {
	background-color: rgba(245, 34, 45, 0.2);
	color: #f5222d;
}

.sentiment-slightly-bullish {
	background-color: rgba(245, 34, 45, 0.1);
	color: #f5222d;
}

.sentiment-slightly-bearish {
	background-color: rgba(82, 196, 26, 0.1);
	color: #52c41a;
}

.sentiment-bearish {
	background-color: rgba(82, 196, 26, 0.2);
	color: #52c41a;
}

.outlook-content {
	font-size: 26rpx;
	line-height: 1.5;
}

.dark-theme .outlook-content {
	color: #bbb;
}

.light-theme .outlook-content {
	color: #666;
}

/* æ”¯æ’‘é˜»åŠ›ä½æ ·å¼ */
.levels-container {
	position: relative;
	padding: 20rpx 0;
}

.resistance-levels, .support-levels {
	display: flex;
	flex-direction: column;
}

.level-item {
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 10rpx 20rpx;
	margin: 5rpx 0;
	border-radius: 6rpx;
	font-size: 24rpx;
}

.resistance {
	color: #f5222d;
}

.dark-theme .resistance {
	background-color: rgba(245, 34, 45, 0.1);
}

.light-theme .resistance {
	background-color: rgba(245, 34, 45, 0.05);
}

.support {
	color: #52c41a;
}

.dark-theme .support {
	background-color: rgba(82, 196, 26, 0.1);
}

.light-theme .support {
	background-color: rgba(82, 196, 26, 0.05);
}

.level-strength {
	font-size: 22rpx;
	opacity: 0.8;
}

.current-price-line {
	position: relative;
	height: 40rpx;
	margin: 15rpx 0;
	border-left: 3rpx dashed #999;
	display: flex;
	align-items: center;
}

.current-price-marker {
	font-size: 26rpx;
	font-weight: bold;
	background-color: #4c8dff;
	color: #fff;
	padding: 5rpx 10rpx;
	border-radius: 4rpx;
	margin-left: 10rpx;
}

/* å…³é”®å› ç´ æ ·å¼ */
.factors-list {
	margin-top: 10rpx;
}

.factor-item {
	display: flex;
	margin-bottom: 15rpx;
	padding: 10rpx;
	border-radius: 6rpx;
}

.dark-theme .factor-item {
	background-color: #333;
}

.light-theme .factor-item {
	background-color: #f5f5f5;
}

.factor-icon {
	width: 50rpx;
	height: 50rpx;
	border-radius: 25rpx;
	display: flex;
	justify-content: center;
	align-items: center;
	font-size: 28rpx;
	margin-right: 15rpx;
}

.factor-icon.positive {
	background-color: rgba(82, 196, 26, 0.2);
	color: #52c41a;
}

.factor-icon.negative {
	background-color: rgba(245, 34, 45, 0.2);
	color: #f5222d;
}

.factor-icon.neutral {
	background-color: rgba(250, 173, 20, 0.2);
	color: #faad14;
}

.factor-content {
	flex: 1;
}

.factor-name {
	font-size: 26rpx;
	font-weight: bold;
	margin-bottom: 5rpx;
}

.factor-desc {
	font-size: 24rpx;
}

.dark-theme .factor-desc {
	color: #999;
}

.light-theme .factor-desc {
	color: #666;
}

/* é¢„æµ‹æ€§èƒ½æ ·å¼ */
.performance-stats {
	display: flex;
	justify-content: space-around;
	margin-bottom: 30rpx;
}

.performance-item {
	display: flex;
	flex-direction: column;
	align-items: center;
}

.performance-value {
	font-size: 32rpx;
	font-weight: bold;
	margin-bottom: 5rpx;
}

.performance-label {
	font-size: 24rpx;
	color: #999;
}

.historical-accuracy {
	margin-top: 20rpx;
}

.accuracy-header {
	font-size: 28rpx;
	font-weight: bold;
	margin-bottom: 15rpx;
}

.accuracy-chart-placeholder {
	height: 200rpx;
	display: flex;
	justify-content: center;
	align-items: center;
	border-radius: 8rpx;
}

.dark-theme .accuracy-chart-placeholder {
	background-color: #333;
}

.light-theme .accuracy-chart-placeholder {
	background-color: #f0f0f0;
}
</style> 