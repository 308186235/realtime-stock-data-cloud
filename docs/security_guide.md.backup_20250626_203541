# 回测系统安全指南

本文档介绍股票交易策略回测系统的安全措施和最佳实践。系统实现了多层安全保护机制，以确保数据和用户交互的安全性。

## 1. 认证与授权

### 用户认证
系统采用基于JWT (JSON Web Token) 的认证机制，确保只有经过授权的用户才能访问回测功能和历史记录。

- **登录流程**: 用户通过登录页面提供用户名和密码进行认证
- **令牌管理**: 登录成功后，系统生成JWT令牌并存储在客户端
- **认证有效期**: 令牌设置30分钟有效期，过期后需要重新登录
- **安全存储**: 密码使用bcrypt算法进行单向哈希存储，即使数据泄露也不会暴露原始密码

### 权限控制
- 每个用户只能访问自己创建的回测记录
- API接口强制验证用户身份和权限
- 页面路由保护，未登录用户会被重定向到登录页面

## 2. 防御机制

### CSRF保护
系统实现了跨站请求伪造(CSRF)保护，确保恶意网站无法代表用户提交未授权请求：

- 为每个会话生成唯一的CSRF令牌
- 所有非GET请求必须附带有效的CSRF令牌
- 通过双重提交Cookie策略验证令牌合法性

### 速率限制
为防止暴力攻击和过度请求，系统实现了API速率限制：

- 默认每个用户每分钟最多允许100个请求
- 超出限制的请求会返回429错误
- 速率限制基于IP地址和用户标识，避免单一来源的攻击

### 安全头设置
所有HTTP响应都添加了安全头信息：

- `X-Content-Type-Options: nosniff`: 防止MIME类型嗅探攻击
- `X-Frame-Options: DENY`: 防止点击劫持攻击
- `X-XSS-Protection: 1; mode=block`: 增强XSS保护
- `Strict-Transport-Security`: 强制使用HTTPS连接
- `Content-Security-Policy`: 限制资源加载来源，防止XSS和数据注入攻击

## 3. 输入验证和数据安全

### 输入验证和过滤
- 所有API请求参数经过严格校验，防止注入攻击
- 使用Pydantic模型验证数据类型和格式
- 对股票代码、日期范围和策略参数进行合法性检查
- 特殊字符过滤，防止命令注入和XSS攻击

### 数据保护
- 敏感错误信息不直接返回给用户，防止信息泄露
- 返回的错误消息经过清理，不包含内部实现细节
- 后端实现针对认证失败的日志记录，方便追踪可能的攻击

## 4. 安全最佳实践

### 运行环境安全
- 推荐使用HTTPS协议部署系统，保护传输层安全
- 使用非特权用户运行服务，减少潜在风险
- 定期更新依赖库，修复已知安全漏洞
- 在生产环境中禁用调试功能和详细错误显示

### 认证安全建议
- 定期更改管理员密码
- 使用强密码策略（至少8个字符，包含字母、数字和符号）
- 避免在多个系统中重复使用相同密码
- 敏感操作进行二次确认

### 数据处理
- 定期备份回测数据
- 实际部署时应将用户密码和关键配置存储在加密数据库中
- 敏感信息（如API密钥、数据库凭证）使用环境变量或安全密钥管理系统提供，而非硬编码

## 5. 安全性和性能平衡

系统在实现多层安全机制的同时，也注重性能优化：

- 使用JWT减少数据库认证请求
- 通过Redis等缓存服务优化速率限制实现（生产环境建议）
- 针对大型回测任务采用异步处理机制
- 采用分层的安全策略，确保核心功能高效运行

## 6. 安全责任与限制

- 本系统的安全措施主要针对常见威胁提供保护
- 用户应确保访问系统的设备和网络环境安全
- 在关键决策和实际交易前，应验证回测结果的合理性
- 系统安全是一个持续过程，定期审查和更新安全措施是必要的

如果发现任何安全问题，请立即联系系统管理员。 