# 策略回测系统使用指南

本文档介绍交易策略回测系统的使用方法,功能特点和实现原理。

## 1. 系统概述

策略回测系统是一个用于验证和优化交易策略的工具,它模拟历史行情数据,执行交易策略并生成详细的绩效报告。目前支持以下K线形态策略的回测:

- **倒三红形 (Inverted Three Red)**: 高位滞涨信号,表现为三根连续阳线,但实体逐渐减小,上影线逐渐增长。
- **红三兵 (Red Three Soldiers)**: 底部反转或上涨中继信号,表现为三根连续阳线,实体大小相似,上影线短。

## 2. 快速开始

### 启动系统

```bash
# 启动后端服务
start_backend.bat
# 或在Linux/Mac上
cd backend
python main.py

# 启动前端服务
start_frontend.bat
# 或在Linux/Mac上
cd frontend/stock5
npm run serve
```

启动后,在前端界面的菜单栏中选择"回测"选项卡进入回测系统。

### 创建回测

1. 在策略回测界面的"新建回测"标签页中设置回测参数:
   - 添加股票代码(可添加多个)
   - 设置回测日期范围
   - 设置初始资金和手续费率
   - 配置策略参数

2. 点击"运行回测"按钮开始回测,系统将模拟历史数据并执行策略。

3. 回测完成后,系统将显示详细的回测结果,包括:
   - 性能指标:总收益率,年化收益率,夏普比率,最大回撤等
   - 权益曲线,回撤曲线,月度收益热图等可视化图表
   - 交易记录明细

4. 您可以给回测结果命名并保存,以便后续查看和比较。

### 查看历史回测

在"历史回测"标签页可以查看所有保存的回测记录,并可以点击查看详细结果。

## 3. 策略参数指南

### 倒三红形策略参数

#### 基本参数:
- **实体减小阈值**:判断后续K线实体减小的比例阈值(例如0.67表示后一根K线的实体至少是前一根的67%)
- **上影线增长阈值**:判断上影线增长的阈值
- **成交量阈值**:用于判断成交量变化的阈值

#### 高级参数:
- **高位阈值**:判断价格处于高位的阈值(0-1之间,越接近1表示价格越高)
- **低位阈值**:判断价格处于低位的阈值(0-1之间,越接近0表示价格越低)
- **高位减仓比例**:高位信号出现时的减仓比例
- **中位减仓比例**:中位信号出现时的减仓比例
- **低位试仓仓位**:低位信号出现时的买入仓位比例

### 红三兵策略参数

#### 基本参数:
- **实体相似度阈值**:判断K线实体相似的阈值(例如0.8表示后一根K线的实体至少是前一根的80%)
- **上影线最大比例**:上影线相对实体的最大比例
- **最小总涨幅**:三根K线的最小总涨幅

#### 高级参数:
- **高位阈值**:判断价格处于高位的阈值
- **低位阈值**:判断价格处于低位的阈值
- **高位放量阈值**:高位警示的成交量增长阈值
- **高位试探仓位**:高位买入信号的仓位比例
- **中位加仓仓位**:中位买入信号的仓位比例
- **低位买入仓位**:低位买入信号的仓位比例

## 4. 回测结果解读

### 性能指标

- **总收益率**:整个回测期间的总收益率
- **年化收益率**:年化后的收益率
- **夏普比率**:风险调整后的收益指标,一般认为>1是不错的结果
- **最大回撤**:单次最大的下跌幅度
- **胜率**:盈利交易占总交易的比例
- **盈亏比**:平均盈利与平均亏损的比值
- **交易次数**:回测期间的总交易次数

### 图表

- **权益曲线**:展示回测期间资金的增长情况
- **回撤曲线**:展示资金从高点到低点的下跌幅度
- **月度收益**:热图形式展示每月的收益情况
- **交易分布**:展示交易盈亏的分布情况

## 5. 技术实现

回测系统由以下主要组件构成:

- **回测引擎**:负责模拟交易执行,资金管理和持仓更新
- **策略适配器**:将交易策略适配到回测引擎
- **数据服务**:提供历史行情数据
- **性能分析器**:计算性能指标,生成可视化图表
- **用户界面**:提供参数配置和结果展示

系统采用前后端分离架构,后端使用FastAPI,前端使用Vue.js开发。

## 6. 扩展和注意事项

### 添加新策略

要添加新的交易策略,需要:

1. 创建策略实现类
2. 创建策略回测适配器
3. 更新API接口和前端表单

### 数据说明

当前版本使用模拟数据进行回测,实际使用时应连接到真实的历史数据源。在模拟数据中,系统会自动注入一些K线形态,以便于测试策略的效果。

### 风险提示

回测结果仅供参考,不代表未来实际交易的表现。影响回测结果与实际表现差异的因素包括:

- 回测使用的是历史数据,未来市场环境可能变化
- 回测中忽略了一些现实中的因素,如流动性,市场冲击等
- 参数优化可能导致过拟合,使策略仅在特定历史数据上表现良好 
