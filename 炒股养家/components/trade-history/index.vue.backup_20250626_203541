<template>
	<view class="container">
		<view class="header">
			<text class="title">äº¤æ˜“å†å²</text>
			<text class="subtitle">æŸ¥çœ‹å’Œåˆ†ææ‚¨çš„å†å²äº¤æ˜“è®°å½•</text>
		</view>
		
		<!-- äº¤æ˜“ç»Ÿè®¡ -->
		<view class="section">
			<view class="section-header">
				<text class="section-title">äº¤æ˜“ç»Ÿè®¡</text>
				<picker @change="changeDateRange" :value="dateRangeIndex" :range="dateRanges">
					<view class="picker">{{ dateRanges[dateRangeIndex] }}</view>
				</picker>
			</view>
			
			<view class="stats-cards">
				<view class="stat-card">
					<text class="stat-label">æ€»äº¤æ˜“ç¬”æ•°</text>
					<text class="stat-value">{{ stats.totalTrades }}</text>
				</view>
				<view class="stat-card">
					<text class="stat-label">ç›ˆåˆ©äº¤æ˜“</text>
					<text class="stat-value profit">{{ stats.profitTrades }}</text>
				</view>
				<view class="stat-card">
					<text class="stat-label">äºæŸäº¤æ˜“</text>
					<text class="stat-value loss">{{ stats.lossTrades }}</text>
				</view>
				<view class="stat-card">
					<text class="stat-label">èƒœç‡</text>
					<text class="stat-value">{{ stats.winRate }}%</text>
				</view>
			</view>
			
			<view class="profit-summary">
				<view class="summary-item">
					<text class="summary-label">æ€»ç›ˆäº</text>
					<text :class="['summary-value', stats.totalProfit >= 0 ? 'profit' : 'loss']">
						{{ stats.totalProfit >= 0 ? '+' : '' }}{{ stats.totalProfit }}å…ƒ
					</text>
				</view>
				<view class="summary-item">
					<text class="summary-label">å¹³å‡æ”¶ç›Šç‡</text>
					<text :class="['summary-value', stats.avgReturn >= 0 ? 'profit' : 'loss']">
						{{ stats.avgReturn >= 0 ? '+' : '' }}{{ stats.avgReturn }}%
					</text>
				</view>
			</view>
			
			<view class="agent-analysis-button" @click="navigateToAIAnalysis">
				<text class="agent-analysis-text">AIå­¦ä¹ åˆ†æ</text>
				<text class="agent-analysis-icon">ğŸ§ </text>
			</view>
		</view>
		
		<!-- äº¤æ˜“è®°å½•ç­›é€‰ -->
		<view class="section">
			<view class="section-header">
				<text class="section-title">äº¤æ˜“è®°å½•</text>
			</view>
			
			<view class="filter-bar">
				<view class="filter-group">
					<text class="filter-label">ç±»å‹</text>
					<view class="filter-options">
						<text class="filter-option" :class="{active: tradeType === 'all'}" @click="tradeType = 'all'">å…¨éƒ¨</text>
						<text class="filter-option" :class="{active: tradeType === 'buy'}" @click="tradeType = 'buy'">ä¹°å…¥</text>
						<text class="filter-option" :class="{active: tradeType === 'sell'}" @click="tradeType = 'sell'">å–å‡º</text>
					</view>
				</view>
				
				<view class="filter-group">
					<text class="filter-label">ç»“æœ</text>
					<view class="filter-options">
						<text class="filter-option" :class="{active: profitFilter === 'all'}" @click="profitFilter = 'all'">å…¨éƒ¨</text>
						<text class="filter-option" :class="{active: profitFilter === 'profit'}" @click="profitFilter = 'profit'">ç›ˆåˆ©</text>
						<text class="filter-option" :class="{active: profitFilter === 'loss'}" @click="profitFilter = 'loss'">äºæŸ</text>
					</view>
				</view>
			</view>
		</view>
		
		<!-- äº¤æ˜“è®°å½•åˆ—è¡¨ -->
		<view class="trade-list">
			<view v-if="filteredTrades.length === 0" class="empty-tip">
				<text class="empty-text">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„äº¤æ˜“è®°å½•</text>
			</view>
			
			<view v-else class="trade-item" v-for="(item, index) in filteredTrades" :key="index" @click="showTradeDetail(item)">
				<view class="trade-header">
					<view class="stock-info">
						<text class="stock-code">{{ item.code }}</text>
						<text class="stock-name">{{ item.name }}</text>
					</view>
					<text :class="['trade-profit', item.profit >= 0 ? 'profit' : 'loss']">
						{{ item.profit >= 0 ? '+' : '' }}{{ item.profit }}å…ƒ
					</text>
				</view>
				
				<view class="trade-details">
					<view class="detail-row">
						<text class="detail-label">{{ item.type === 'buy' ? 'ä¹°å…¥ä»·' : 'å–å‡ºä»·' }}</text>
						<text class="detail-value">{{ item.price }}å…ƒ</text>
					</view>
					<view class="detail-row">
						<text class="detail-label">æ•°é‡</text>
						<text class="detail-value">{{ item.quantity }}è‚¡</text>
					</view>
					<view class="detail-row">
						<text class="detail-label">äº¤æ˜“é¢</text>
						<text class="detail-value">{{ item.amount }}å…ƒ</text>
					</view>
				</view>
				
				<view class="trade-footer">
					<text class="trade-type" :class="item.type">{{ item.type === 'buy' ? 'ä¹°å…¥' : 'å–å‡º' }}</text>
					<text class="trade-time">{{ item.time }}</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
export default {
	data() {
		return {
			// æ—¥æœŸèŒƒå›´é€‰æ‹©
			dateRanges: ['æœ€è¿‘ä¸€å‘¨', 'æœ€è¿‘ä¸€æœˆ', 'æœ€è¿‘ä¸‰æœˆ', 'å…¨éƒ¨'],
			dateRangeIndex: 0,
			
			// ç­›é€‰æ¡ä»¶
			tradeType: 'all',
			profitFilter: 'all',
			
			// ç»Ÿè®¡æ•°æ®
			stats: {
				totalTrades: 28,
				profitTrades: 18,
				lossTrades: 10,
				winRate: 64.3,
				totalProfit: 5280.75,
				avgReturn: 3.2
			},
			
			// äº¤æ˜“è®°å½•
			trades: [
				{
					id: 1,
					code: 'SH600519',
					name: 'è´µå·èŒ…å°',
					type: 'buy',
					price: 1789.50,
					quantity: 10,
					amount: 17895.00,
					profit: 0,
					time: '2023-05-15 10:23:45'
				},
				{
					id: 2,
					code: 'SH600519',
					name: 'è´µå·èŒ…å°',
					type: 'sell',
					price: 1825.30,
					quantity: 10,
					amount: 18253.00,
					profit: 358.00,
					time: '2023-05-18 14:35:22'
				},
				{
					id: 3,
					code: 'SZ000858',
					name: 'äº”ç²®æ¶²',
					type: 'buy',
					price: 168.75,
					quantity: 100,
					amount: 16875.00,
					profit: 0,
					time: '2023-05-20 09:45:12'
				},
				{
					id: 4,
					code: 'SZ000858',
					name: 'äº”ç²®æ¶²',
					type: 'sell',
					price: 165.20,
					quantity: 100,
					amount: 16520.00,
					profit: -355.00,
					time: '2023-05-22 15:10:33'
				},
				{
					id: 5,
					code: 'SH601318',
					name: 'ä¸­å›½å¹³å®‰',
					type: 'buy',
					price: 48.32,
					quantity: 500,
					amount: 24160.00,
					profit: 0,
					time: '2023-05-25 11:05:18'
				},
				{
					id: 6,
					code: 'SH601318',
					name: 'ä¸­å›½å¹³å®‰',
					type: 'sell',
					price: 51.75,
					quantity: 500,
					amount: 25875.00,
					profit: 1715.00,
					time: '2023-06-02 10:18:42'
				}
			]
		}
	},
	computed: {
		filteredTrades() {
			return this.trades.filter(trade => {
				// æ ¹æ®äº¤æ˜“ç±»å‹ç­›é€‰
				if (this.tradeType !== 'all' && trade.type !== this.tradeType) {
					return false
				}
				
				// æ ¹æ®ç›ˆäºç­›é€‰
				if (this.profitFilter === 'profit' && trade.profit <= 0) {
					return false
				}
				
				if (this.profitFilter === 'loss' && trade.profit >= 0) {
					return false
				}
				
				return true
			})
		}
	},
	methods: {
		// åˆ‡æ¢æ—¥æœŸèŒƒå›´
		changeDateRange(e) {
			this.dateRangeIndex = e.detail.value
			this.updateStats()
		},
		
		// æ›´æ–°ç»Ÿè®¡æ•°æ®
		updateStats() {
			// æ ¹æ®é€‰æ‹©çš„æ—¥æœŸèŒƒå›´æ›´æ–°ç»Ÿè®¡æ•°æ®
			// è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
			const ranges = [
				{ totalTrades: 28, profitTrades: 18, lossTrades: 10, winRate: 64.3, totalProfit: 5280.75, avgReturn: 3.2 },
				{ totalTrades: 52, profitTrades: 30, lossTrades: 22, winRate: 57.7, totalProfit: 8750.25, avgReturn: 2.8 },
				{ totalTrades: 87, profitTrades: 48, lossTrades: 39, winRate: 55.2, totalProfit: 12580.50, avgReturn: 2.5 },
				{ totalTrades: 156, profitTrades: 89, lossTrades: 67, winRate: 57.1, totalProfit: 25680.80, avgReturn: 2.7 }
			]
			
			this.stats = ranges[this.dateRangeIndex]
		},
		
		// æ˜¾ç¤ºäº¤æ˜“è¯¦æƒ…
		showTradeDetail(trade) {
			uni.showModal({
				title: `${trade.type === 'buy' ? 'ä¹°å…¥' : 'å–å‡º'}è¯¦æƒ…`,
				content: `è‚¡ç¥¨: ${trade.name} (${trade.code})\nä»·æ ¼: ${trade.price}å…ƒ\næ•°é‡: ${trade.quantity}è‚¡\né‡‘é¢: ${trade.amount}å…ƒ\næ—¶é—´: ${trade.time}\n${trade.type === 'sell' ? 'ç›ˆäº: ' + (trade.profit >= 0 ? '+' : '') + trade.profit + 'å…ƒ' : ''}`,
				showCancel: false
			})
		},
		
		// å¯¼èˆªåˆ°AIå­¦ä¹ åˆ†æé¡µé¢
		navigateToAIAnalysis() {
			uni.navigateTo({
				url: '/pages/agent-analysis/learning/index'
			})
		}
	},
	onLoad() {
		// åˆå§‹åŒ–æ•°æ®
		this.updateStats()
	}
}
</script>

<style>
.container {
	padding: 30rpx;
}

.header {
	padding: 20rpx 0;
	margin-bottom: 30rpx;
}

.title {
	font-size: 36rpx;
	font-weight: bold;
	margin-bottom: 10rpx;
}

.subtitle {
	font-size: 24rpx;
	color: #666;
}

.section {
	margin-bottom: 30rpx;
	background-color: #fff;
	border-radius: 12rpx;
	padding: 20rpx;
	box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);
}

.section-header {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 20rpx;
}

.section-title {
	font-size: 28rpx;
	font-weight: bold;
}

.picker {
	font-size: 24rpx;
	color: #1989fa;
}

/* ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
.stats-cards {
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	margin-bottom: 20rpx;
}

.stat-card {
	width: 25%;
	padding: 10rpx;
	align-items: center;
}

.stat-label {
	font-size: 22rpx;
	color: #666;
	margin-bottom: 10rpx;
}

.stat-value {
	font-size: 32rpx;
	font-weight: bold;
}

.profit-summary {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	padding: 20rpx 0;
	border-top: 1px solid #f0f0f0;
}

.summary-item {
	align-items: center;
}

.summary-label {
	font-size: 24rpx;
	color: #666;
	margin-bottom: 10rpx;
}

.summary-value {
	font-size: 34rpx;
	font-weight: bold;
}

/* ç­›é€‰æ æ ·å¼ */
.filter-bar {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	padding: 10rpx 0;
}

.filter-group {
	flex: 1;
}

.filter-label {
	font-size: 24rpx;
	color: #666;
	margin-bottom: 10rpx;
}

.filter-options {
	display: flex;
	flex-direction: row;
}

.filter-option {
	padding: 8rpx 20rpx;
	font-size: 24rpx;
	background-color: #f5f5f5;
	margin-right: 10rpx;
	border-radius: 30rpx;
}

.filter-option.active {
	background-color: #1989fa;
	color: white;
}

/* äº¤æ˜“è®°å½•åˆ—è¡¨æ ·å¼ */
.trade-list {
	margin-top: 20rpx;
}

.trade-item {
	background-color: #fff;
	border-radius: 12rpx;
	padding: 20rpx;
	margin-bottom: 20rpx;
	box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);
}

.trade-header {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 15rpx;
}

.stock-info {
	flex-direction: column;
}

.stock-code {
	font-size: 24rpx;
	color: #666;
}

.stock-name {
	font-size: 28rpx;
	font-weight: bold;
}

.trade-profit {
	font-size: 32rpx;
	font-weight: bold;
}

.trade-details {
	padding: 15rpx 0;
	border-top: 1px solid #f0f0f0;
	border-bottom: 1px solid #f0f0f0;
	margin-bottom: 15rpx;
}

.detail-row {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	margin-bottom: 10rpx;
}

.detail-label {
	font-size: 24rpx;
	color: #666;
}

.detail-value {
	font-size: 24rpx;
}

.trade-footer {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
}

.trade-type {
	padding: 4rpx 12rpx;
	font-size: 22rpx;
	border-radius: 4rpx;
}

.trade-type.buy {
	background-color: #e6f7ff;
	color: #1989fa;
}

.trade-type.sell {
	background-color: #fff2e8;
	color: #fa8c16;
}

.trade-time {
	font-size: 22rpx;
	color: #999;
}

.profit {
	color: #f5222d;
}

.loss {
	color: #52c41a;
}

.empty-tip {
	padding: 50rpx;
	align-items: center;
}

.empty-text {
	font-size: 26rpx;
	color: #999;
}

.agent-analysis-button {
	display: flex;
	flex-direction: row;
	justify-content: center;
	align-items: center;
	background-color: #f0f7ff;
	padding: 15rpx;
	margin-top: 20rpx;
	border-radius: 8rpx;
	border: 1px dashed #1989fa;
}

.agent-analysis-text {
	font-size: 28rpx;
	color: #1989fa;
	font-weight: bold;
}

.agent-analysis-icon {
	font-size: 30rpx;
	margin-left: 10rpx;
}
</style> 