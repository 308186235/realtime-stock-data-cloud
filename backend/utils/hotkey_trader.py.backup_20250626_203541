#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å¿«æ·é”®äº¤æ˜“æ¨¡å— - é€šè¿‡å¿«æ·é”®è‡ªåŠ¨æ‰§è¡Œä¸œå´è¯åˆ¸äº¤æ˜“æ“ä½œ
æ”¯æŒä¹°å…¥ã€å–å‡ºã€æŸ¥è¯¢æŒä»“ã€æŸ¥è¯¢èµ„é‡‘ç­‰åŠŸèƒ½
"""

import win32gui
import win32con
import win32api
import time
import sys
import os
import json
import re
import pyautogui
import threading
import keyboard
from datetime import datetime

# å®šä¹‰ä¸œå´è¯åˆ¸å¸¸ç”¨åŠŸèƒ½é”®
DONGWU_HOTKEYS = {
    'BUY': 'F1',          # ä¹°å…¥é¡µé¢
    'SELL': 'F2',         # å–å‡ºé¡µé¢
    'ORDER': 'F3',        # å§”æ‰˜é¡µé¢
    'POSITION': 'F4',     # æŒä»“é¡µé¢
    'FUND': 'F5',         # èµ„é‡‘é¡µé¢
    'CANCEL': 'F6',       # æ’¤å•é¡µé¢
    'CONFIRM': 'Enter',   # ç¡®è®¤æ“ä½œ
    'TAB': 'Tab',         # åˆ‡æ¢è¾“å…¥æ¡†
    'ESCAPE': 'Esc'       # å–æ¶ˆæ“ä½œ
}

class HotkeyTrader:
    """å¿«æ·é”®äº¤æ˜“å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨ä¹°å…¥å–å‡ºã€ä¸€é”®äº¤æ˜“ç­‰åŠŸèƒ½"""
    
    def __init__(self, config_file=None):
        """åˆå§‹åŒ–å¿«æ·é”®äº¤æ˜“å·¥å…·"""
        self.config = self._load_config(config_file)
        self.trading_active = False
        self.hotkey_thread = None
        self.last_operation = None
        self.last_operation_time = None
        
        # ä¿å­˜çª—å£ä¿¡æ¯
        self.dongwu_window = None
        self.window_title = ""
        
    def _load_config(self, config_file=None):
        """åŠ è½½é…ç½®æ–‡ä»¶"""
        default_config = {
            "çª—å£æ ‡é¢˜": ["ä¸œå´è¯åˆ¸", "ç½‘ä¸Šè‚¡ç¥¨äº¤æ˜“ç³»ç»Ÿ"],
            "å¿«æ·é”®": {
                "ä¹°å…¥": "F1",
                "å–å‡º": "F2",
                "å§”æ‰˜": "F3",
                "èµ„é‡‘": "F4",
                "æŒä»“": "F5"
            },
            "é»˜è®¤äº¤æ˜“å‚æ•°": {
                "æœ€å°äº¤æ˜“æ•°é‡": 100,
                "æ•°é‡å€æ•°": 100,
                "ä»·æ ¼ç²¾åº¦": 2,
                "å»¶è¿Ÿæ—¶é—´": 0.3
            },
            "è‡ªå®šä¹‰å¿«æ·é”®": {
                "ä¸€é”®ä¹°å…¥": "ctrl+1",
                "ä¸€é”®å–å‡º": "ctrl+2",
                "ä¸€é”®æŸ¥æŒä»“": "ctrl+3",
                "ä¸€é”®æŸ¥èµ„é‡‘": "ctrl+4"
            },
            "å®‰å…¨è®¾ç½®": {
                "æ“ä½œé—´éš”æœ€å°æ—¶é—´": 1,  # ç§’
                "æœ€å¤§å•ç¬”äº¤æ˜“é¢": 100000,  # å…ƒ
                "éœ€è¦äºŒæ¬¡ç¡®è®¤çš„é‡‘é¢": 50000  # å…ƒ
            }
        }
        
        if config_file and os.path.exists(config_file):
            try:
                with open(config_file, 'r', encoding='utf-8') as f:
                    user_config = json.load(f)
                    # åˆå¹¶é…ç½®ï¼Œä¼˜å…ˆä½¿ç”¨ç”¨æˆ·é…ç½®
                    for key, value in user_config.items():
                        if isinstance(value, dict) and key in default_config:
                            default_config[key].update(value)
                        else:
                            default_config[key] = value
                print(f"âœ… å·²åŠ è½½ç”¨æˆ·é…ç½®: {config_file}")
            except Exception as e:
                print(f"âŒ åŠ è½½é…ç½®å¤±è´¥: {e}")
        
        return default_config
    
    def find_dongwu_window(self):
        """æŸ¥æ‰¾ä¸œå´è¯åˆ¸äº¤æ˜“çª—å£"""
        print("ğŸ” æ­£åœ¨æŸ¥æ‰¾ä¸œå´è¯åˆ¸äº¤æ˜“çª—å£...")
        
        window_titles = self.config["çª—å£æ ‡é¢˜"]
        dongwu_windows = []
        
        def find_window_callback(hwnd, windows):
            if win32gui.IsWindowVisible(hwnd):
                window_text = win32gui.GetWindowText(hwnd)
                for title in window_titles:
                    if title in window_text:
                        windows.append((hwnd, window_text))
                        break
            return True
        
        win32gui.EnumWindows(find_window_callback, dongwu_windows)
        
        if not dongwu_windows:
            print("âŒ æœªæ‰¾åˆ°ä¸œå´è¯åˆ¸äº¤æ˜“çª—å£")
            return False
        
        self.dongwu_window, self.window_title = dongwu_windows[0]
        print(f"âœ… æ‰¾åˆ°ä¸œå´è¯åˆ¸çª—å£: {self.window_title}")
        return True
    
    def send_key(self, key, alt=False, ctrl=False):
        """å‘ä¸œå´è¯åˆ¸çª—å£å‘é€æŒ‰é”®"""
        if not self.dongwu_window and not self.find_dongwu_window():
            return False
            
        try:
            # æ¿€æ´»çª—å£
            win32gui.SetForegroundWindow(self.dongwu_window)
            time.sleep(0.5)
            
            # æŒ‰ä¸‹ä¿®é¥°é”®
            if alt:
                win32api.keybd_event(0x12, 0, 0, 0)  # ALTé”®æŒ‰ä¸‹
            if ctrl:
                win32api.keybd_event(0x11, 0, 0, 0)  # CTRLé”®æŒ‰ä¸‹
            
            time.sleep(0.1)
            
            # åŠŸèƒ½é”®æ˜ å°„
            if key.upper().startswith('F') and len(key) <= 3:
                vk_codes = {
                    'F1': 0x70, 'F2': 0x71, 'F3': 0x72, 'F4': 0x73,
                    'F5': 0x74, 'F6': 0x75, 'F7': 0x76, 'F8': 0x77,
                    'F9': 0x78, 'F10': 0x79, 'F11': 0x7A, 'F12': 0x7B
                }
                
                if key.upper() in vk_codes:
                    vk_code = vk_codes[key.upper()]
                    win32api.keybd_event(vk_code, 0, 0, 0)  # æŒ‰ä¸‹
                    time.sleep(0.1)
                    win32api.keybd_event(vk_code, 0, 2, 0)  # é‡Šæ”¾
            
            # å›è½¦é”®
            elif key.upper() == 'ENTER':
                win32api.keybd_event(0x0D, 0, 0, 0)  # æŒ‰ä¸‹
                time.sleep(0.1)
                win32api.keybd_event(0x0D, 0, 2, 0)  # é‡Šæ”¾
            
            # Tabé”®
            elif key.upper() == 'TAB':
                win32api.keybd_event(0x09, 0, 0, 0)  # æŒ‰ä¸‹
                time.sleep(0.1)
                win32api.keybd_event(0x09, 0, 2, 0)  # é‡Šæ”¾
            
            # ESCé”®
            elif key.upper() == 'ESC':
                win32api.keybd_event(0x1B, 0, 0, 0)  # æŒ‰ä¸‹
                time.sleep(0.1)
                win32api.keybd_event(0x1B, 0, 2, 0)  # é‡Šæ”¾
            
            # æ™®é€šå­—ç¬¦é”®
            else:
                for char in key:
                    # æ•°å­—é”®å•ç‹¬å¤„ç†
                    if char.isdigit():
                        vk_code = ord(char) 
                    else:
                        vk_code = ord(char.upper())
                    
                    win32api.keybd_event(vk_code, 0, 0, 0)  # æŒ‰ä¸‹
                    time.sleep(0.05)
                    win32api.keybd_event(vk_code, 0, 2, 0)  # é‡Šæ”¾
                    time.sleep(0.05)
            
            time.sleep(0.1)
            
            # é‡Šæ”¾ä¿®é¥°é”®
            if ctrl:
                win32api.keybd_event(0x11, 0, 2, 0)  # CTRLé”®é‡Šæ”¾
            if alt:
                win32api.keybd_event(0x12, 0, 2, 0)  # ALTé”®é‡Šæ”¾
            
            time.sleep(self.config["é»˜è®¤äº¤æ˜“å‚æ•°"]["å»¶è¿Ÿæ—¶é—´"])
            
            self.last_operation = key
            self.last_operation_time = datetime.now()
            
            return True
            
        except Exception as e:
            print(f"âŒ å‘é€æŒ‰é”®å¤±è´¥: {e}")
            return False
    
    def navigate_to_buy(self):
        """å¯¼èˆªåˆ°ä¹°å…¥é¡µé¢"""
        return self.send_key(self.config["å¿«æ·é”®"]["ä¹°å…¥"])
    
    def navigate_to_sell(self):
        """å¯¼èˆªåˆ°å–å‡ºé¡µé¢"""
        return self.send_key(self.config["å¿«æ·é”®"]["å–å‡º"])
    
    def navigate_to_position(self):
        """å¯¼èˆªåˆ°æŒä»“é¡µé¢"""
        return self.send_key(self.config["å¿«æ·é”®"]["æŒä»“"])
    
    def navigate_to_fund(self):
        """å¯¼èˆªåˆ°èµ„é‡‘é¡µé¢"""
        return self.send_key(self.config["å¿«æ·é”®"]["èµ„é‡‘"])
        
    def input_stock_code(self, stock_code):
        """è¾“å…¥è‚¡ç¥¨ä»£ç """
        if not stock_code or not re.match(r'^\d{6}$', stock_code):
            print(f"âŒ æ— æ•ˆçš„è‚¡ç¥¨ä»£ç : {stock_code}")
            return False
            
        # æ¸…ç©ºå½“å‰è¾“å…¥æ¡†
        self.send_key('ESC')
        time.sleep(0.2)
        
        # è¾“å…¥è‚¡ç¥¨ä»£ç 
        for digit in stock_code:
            self.send_key(digit)
            time.sleep(0.05)
        
        time.sleep(0.5)
        return True
    
    def input_price(self, price):
        """è¾“å…¥ä»·æ ¼"""
        if not isinstance(price, (int, float)) or price <= 0:
            print(f"âŒ æ— æ•ˆçš„ä»·æ ¼: {price}")
            return False
            
        # åˆ‡æ¢åˆ°ä»·æ ¼è¾“å…¥æ¡†
        self.send_key('TAB')
        time.sleep(0.2)
        
        # æ¸…ç©ºå½“å‰è¾“å…¥æ¡†
        self.send_key('ESC')
        time.sleep(0.2)
        
        # è½¬æ¢ä»·æ ¼ä¸ºå­—ç¬¦ä¸²å¹¶æŒ‰ä½è¾“å…¥
        price_str = str(round(price, self.config["é»˜è®¤äº¤æ˜“å‚æ•°"]["ä»·æ ¼ç²¾åº¦"]))
        for digit in price_str:
            if digit == '.':
                self.send_key('.')
            else:
                self.send_key(digit)
            time.sleep(0.05)
        
        time.sleep(0.3)
        return True
    
    def input_quantity(self, quantity):
        """è¾“å…¥æ•°é‡"""
        if not isinstance(quantity, int) or quantity <= 0:
            print(f"âŒ æ— æ•ˆçš„æ•°é‡: {quantity}")
            return False
            
        # ç¡®ä¿æ•°é‡ç¬¦åˆæœ€å°äº¤æ˜“å•ä½
        min_quantity = self.config["é»˜è®¤äº¤æ˜“å‚æ•°"]["æœ€å°äº¤æ˜“æ•°é‡"]
        quantity_multiple = self.config["é»˜è®¤äº¤æ˜“å‚æ•°"]["æ•°é‡å€æ•°"]
        
        if quantity < min_quantity:
            quantity = min_quantity
            print(f"âš ï¸ æ•°é‡å·²è°ƒæ•´ä¸ºæœ€å°äº¤æ˜“å•ä½: {min_quantity}")
        
        if quantity % quantity_multiple != 0:
            quantity = (quantity // quantity_multiple) * quantity_multiple
            print(f"âš ï¸ æ•°é‡å·²è°ƒæ•´ä¸ºäº¤æ˜“å•ä½å€æ•°: {quantity}")
            
        # åˆ‡æ¢åˆ°æ•°é‡è¾“å…¥æ¡†
        self.send_key('TAB')
        time.sleep(0.2)
        
        # æ¸…ç©ºå½“å‰è¾“å…¥æ¡†
        self.send_key('ESC')
        time.sleep(0.2)
        
        # è¾“å…¥æ•°é‡
        quantity_str = str(quantity)
        for digit in quantity_str:
            self.send_key(digit)
            time.sleep(0.05)
        
        time.sleep(0.3)
        return True
    
    def confirm_order(self):
        """ç¡®è®¤ä¸‹å•"""
        # ä½¿ç”¨å›è½¦é”®ç¡®è®¤
        return self.send_key('ENTER')
    
    def execute_buy(self, stock_code, price, quantity):
        """æ‰§è¡Œä¹°å…¥æ“ä½œ"""
        print(f"ğŸš€ æ‰§è¡Œä¹°å…¥æ“ä½œ: {stock_code}, ä»·æ ¼: {price}, æ•°é‡: {quantity}")
        
        # å®‰å…¨æ£€æŸ¥
        if not self._safety_check(price, quantity):
            return False
        
        # å¯¼èˆªåˆ°ä¹°å…¥é¡µé¢
        if not self.navigate_to_buy():
            return False
            
        # è¾“å…¥è‚¡ç¥¨ä»£ç 
        if not self.input_stock_code(stock_code):
            return False
            
        # è¾“å…¥ä»·æ ¼
        if not self.input_price(price):
            return False
            
        # è¾“å…¥æ•°é‡
        if not self.input_quantity(quantity):
            return False
            
        # ç¡®è®¤ä¸‹å•
        if self.confirm_order():
            print(f"âœ… ä¹°å…¥å§”æ‰˜å·²æäº¤: {stock_code}, ä»·æ ¼: {price}, æ•°é‡: {quantity}")
            return True
        else:
            print("âŒ ä¹°å…¥å§”æ‰˜æäº¤å¤±è´¥")
            return False
    
    def execute_sell(self, stock_code, price, quantity):
        """æ‰§è¡Œå–å‡ºæ“ä½œ"""
        print(f"ğŸš€ æ‰§è¡Œå–å‡ºæ“ä½œ: {stock_code}, ä»·æ ¼: {price}, æ•°é‡: {quantity}")
        
        # å®‰å…¨æ£€æŸ¥
        if not self._safety_check(price, quantity):
            return False
        
        # å¯¼èˆªåˆ°å–å‡ºé¡µé¢
        if not self.navigate_to_sell():
            return False
            
        # è¾“å…¥è‚¡ç¥¨ä»£ç 
        if not self.input_stock_code(stock_code):
            return False
            
        # è¾“å…¥ä»·æ ¼
        if not self.input_price(price):
            return False
            
        # è¾“å…¥æ•°é‡
        if not self.input_quantity(quantity):
            return False
            
        # ç¡®è®¤ä¸‹å•
        if self.confirm_order():
            print(f"âœ… å–å‡ºå§”æ‰˜å·²æäº¤: {stock_code}, ä»·æ ¼: {price}, æ•°é‡: {quantity}")
            return True
        else:
            print("âŒ å–å‡ºå§”æ‰˜æäº¤å¤±è´¥")
            return False
    
    def _safety_check(self, price, quantity):
        """äº¤æ˜“å®‰å…¨æ£€æŸ¥"""
        # æ£€æŸ¥äº¤æ˜“é‡‘é¢æ˜¯å¦è¶…é™
        trade_amount = price * quantity
        max_amount = self.config["å®‰å…¨è®¾ç½®"]["æœ€å¤§å•ç¬”äº¤æ˜“é¢"]
        
        if trade_amount > max_amount:
            print(f"âš ï¸ å®‰å…¨è­¦å‘Š: äº¤æ˜“é‡‘é¢ {trade_amount} å…ƒè¶…è¿‡æœ€å¤§é™åˆ¶ {max_amount} å…ƒ")
            confirm = input("æ˜¯å¦ç»§ç»­äº¤æ˜“? (y/n): ")
            if confirm.lower() != 'y':
                print("âŒ äº¤æ˜“å·²å–æ¶ˆ")
                return False
        
        # æ£€æŸ¥æ˜¯å¦éœ€è¦äºŒæ¬¡ç¡®è®¤
        confirm_amount = self.config["å®‰å…¨è®¾ç½®"]["éœ€è¦äºŒæ¬¡ç¡®è®¤çš„é‡‘é¢"]
        if trade_amount > confirm_amount:
            confirm = input(f"äº¤æ˜“é‡‘é¢ {trade_amount} å…ƒè¾ƒå¤§ï¼Œè¯·ç¡®è®¤ç»§ç»­ (y/n): ")
            if confirm.lower() != 'y':
                print("âŒ äº¤æ˜“å·²å–æ¶ˆ")
                return False
        
        # æ£€æŸ¥æ“ä½œé—´éš”æ—¶é—´
        if self.last_operation_time:
            time_diff = (datetime.now() - self.last_operation_time).total_seconds()
            min_interval = self.config["å®‰å…¨è®¾ç½®"]["æ“ä½œé—´éš”æœ€å°æ—¶é—´"]
            
            if time_diff < min_interval:
                wait_time = min_interval - time_diff
                print(f"â³ æ“ä½œè¿‡äºé¢‘ç¹ï¼Œç­‰å¾… {wait_time:.1f} ç§’...")
                time.sleep(wait_time)
        
        return True
    
    def register_hotkeys(self):
        """æ³¨å†Œå…¨å±€å¿«æ·é”®"""
        if self.trading_active:
            print("âš ï¸ å¿«æ·é”®å·²ç»æ¿€æ´»ï¼Œè¯·å‹¿é‡å¤æ³¨å†Œ")
            return
            
        custom_keys = self.config["è‡ªå®šä¹‰å¿«æ·é”®"]
        
        try:
            # æ³¨å†Œä¸€é”®ä¹°å…¥
            keyboard.add_hotkey(custom_keys["ä¸€é”®ä¹°å…¥"], self._quick_buy_handler)
            
            # æ³¨å†Œä¸€é”®å–å‡º
            keyboard.add_hotkey(custom_keys["ä¸€é”®å–å‡º"], self._quick_sell_handler)
            
            # æ³¨å†Œä¸€é”®æŸ¥æŒä»“
            keyboard.add_hotkey(custom_keys["ä¸€é”®æŸ¥æŒä»“"], self._quick_position_handler)
            
            # æ³¨å†Œä¸€é”®æŸ¥èµ„é‡‘
            keyboard.add_hotkey(custom_keys["ä¸€é”®æŸ¥èµ„é‡‘"], self._quick_fund_handler)
            
            self.trading_active = True
            print(f"âœ… å¿«æ·é”®äº¤æ˜“å·²æ¿€æ´»!")
            print(f"ğŸ“‹ {custom_keys['ä¸€é”®ä¹°å…¥']}: ä¸€é”®ä¹°å…¥")
            print(f"ğŸ“‹ {custom_keys['ä¸€é”®å–å‡º']}: ä¸€é”®å–å‡º")
            print(f"ğŸ“‹ {custom_keys['ä¸€é”®æŸ¥æŒä»“']}: ä¸€é”®æŸ¥çœ‹æŒä»“")
            print(f"ğŸ“‹ {custom_keys['ä¸€é”®æŸ¥èµ„é‡‘']}: ä¸€é”®æŸ¥çœ‹èµ„é‡‘")
            
        except Exception as e:
            print(f"âŒ æ³¨å†Œå¿«æ·é”®å¤±è´¥: {e}")
    
    def _quick_buy_handler(self):
        """ä¸€é”®ä¹°å…¥å¤„ç†å‡½æ•°"""
        if not self.trading_active:
            return
            
        print("\nğŸ”µ è§¦å‘ä¸€é”®ä¹°å…¥å¿«æ·é”®")
        
        # è·å–ä¹°å…¥å‚æ•°
        stock_code = input("è¯·è¾“å…¥è‚¡ç¥¨ä»£ç : ")
        if not re.match(r'^\d{6}$', stock_code):
            print("âŒ æ— æ•ˆçš„è‚¡ç¥¨ä»£ç ")
            return
            
        try:
            price = float(input("è¯·è¾“å…¥ä¹°å…¥ä»·æ ¼: "))
            quantity = int(input("è¯·è¾“å…¥ä¹°å…¥æ•°é‡: "))
        except ValueError:
            print("âŒ æ— æ•ˆçš„ä»·æ ¼æˆ–æ•°é‡")
            return
            
        # æ‰§è¡Œä¹°å…¥
        self.execute_buy(stock_code, price, quantity)
    
    def _quick_sell_handler(self):
        """ä¸€é”®å–å‡ºå¤„ç†å‡½æ•°"""
        if not self.trading_active:
            return
            
        print("\nğŸ”´ è§¦å‘ä¸€é”®å–å‡ºå¿«æ·é”®")
        
        # è·å–å–å‡ºå‚æ•°
        stock_code = input("è¯·è¾“å…¥è‚¡ç¥¨ä»£ç : ")
        if not re.match(r'^\d{6}$', stock_code):
            print("âŒ æ— æ•ˆçš„è‚¡ç¥¨ä»£ç ")
            return
            
        try:
            price = float(input("è¯·è¾“å…¥å–å‡ºä»·æ ¼: "))
            quantity = int(input("è¯·è¾“å…¥å–å‡ºæ•°é‡: "))
        except ValueError:
            print("âŒ æ— æ•ˆçš„ä»·æ ¼æˆ–æ•°é‡")
            return
            
        # æ‰§è¡Œå–å‡º
        self.execute_sell(stock_code, price, quantity)
    
    def _quick_position_handler(self):
        """ä¸€é”®æŸ¥çœ‹æŒä»“å¤„ç†å‡½æ•°"""
        if not self.trading_active:
            return
            
        print("\nğŸ“Š æŸ¥çœ‹æŒä»“ä¿¡æ¯")
        self.navigate_to_position()
    
    def _quick_fund_handler(self):
        """ä¸€é”®æŸ¥çœ‹èµ„é‡‘å¤„ç†å‡½æ•°"""
        if not self.trading_active:
            return
            
        print("\nğŸ’° æŸ¥çœ‹èµ„é‡‘ä¿¡æ¯")
        self.navigate_to_fund()
    
    def start(self):
        """å¯åŠ¨å¿«æ·é”®äº¤æ˜“ç³»ç»Ÿ"""
        if not self.find_dongwu_window():
            print("âŒ æ— æ³•å¯åŠ¨å¿«æ·é”®äº¤æ˜“ç³»ç»Ÿ: æœªæ‰¾åˆ°ä¸œå´è¯åˆ¸çª—å£")
            return False
            
        self.register_hotkeys()
        
        # å¯åŠ¨çƒ­é”®ç›‘å¬çº¿ç¨‹
        self.hotkey_thread = threading.Thread(target=keyboard.wait)
        self.hotkey_thread.daemon = True
        self.hotkey_thread.start()
        
        return True
    
    def stop(self):
        """åœæ­¢å¿«æ·é”®äº¤æ˜“ç³»ç»Ÿ"""
        if not self.trading_active:
            return
            
        # æ¸…é™¤æ‰€æœ‰çƒ­é”®
        keyboard.unhook_all()
        self.trading_active = False
        print("ğŸ›‘ å¿«æ·é”®äº¤æ˜“ç³»ç»Ÿå·²åœæ­¢")


def main():
    """ä¸»å‡½æ•°"""
    print("=" * 60)
    print("ğŸš€ ä¸œå´è¯åˆ¸å¿«æ·é”®äº¤æ˜“å·¥å…·")
    print("=" * 60)
    
    # è·å–é…ç½®æ–‡ä»¶è·¯å¾„
    config_file = "config/hotkey_trader_config.json"
    if len(sys.argv) > 1:
        config_file = sys.argv[1]
    
    # åˆ›å»ºå¿«æ·é”®äº¤æ˜“å·¥å…·
    trader = HotkeyTrader(config_file)
    
    # å¯åŠ¨å¿«æ·é”®äº¤æ˜“ç³»ç»Ÿ
    if trader.start():
        print("\nâœ… å¿«æ·é”®äº¤æ˜“ç³»ç»Ÿå·²å¯åŠ¨")
        print("ä½¿ç”¨å¿«æ·é”®å³å¯å¿«é€Ÿäº¤æ˜“ï¼ŒæŒ‰Ctrl+Cé€€å‡º")
        
        try:
            # ä¿æŒç¨‹åºè¿è¡Œ
            while trader.trading_active:
                time.sleep(1)
        except KeyboardInterrupt:
            # æ•è·Ctrl+Cé€€å‡º
            trader.stop()
            print("\nğŸ‘‹ æ„Ÿè°¢ä½¿ç”¨å¿«æ·é”®äº¤æ˜“å·¥å…·ï¼Œå†è§!")
    else:
        print("\nâŒ å¿«æ·é”®äº¤æ˜“ç³»ç»Ÿå¯åŠ¨å¤±è´¥")
    
    print("=" * 60)


if __name__ == "__main__":
    main() 