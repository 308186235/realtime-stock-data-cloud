<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª APIè¿æ¥æµ‹è¯•</h1>
        
        <div class="test-item" id="cloud-test">
            <h3>â˜ï¸ äº‘ç«¯APIæµ‹è¯•</h3>
            <p>URL: https://ai-stock-trading-backend.308186235.workers.dev</p>
            <button onclick="testCloudAPI()">æµ‹è¯•äº‘ç«¯API</button>
            <div class="result" id="cloud-result">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="test-item" id="local-test">
            <h3>ğŸ’» æœ¬åœ°APIæµ‹è¯•</h3>
            <p>URL: http://localhost:5000</p>
            <button onclick="testLocalAPI()">æµ‹è¯•æœ¬åœ°API</button>
            <div class="result" id="local-result">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="test-item" id="integration-test">
            <h3>ğŸ”— é›†æˆæµ‹è¯•</h3>
            <button onclick="testIntegration()">æµ‹è¯•å®Œæ•´æµç¨‹</button>
            <div class="result" id="integration-result">ç­‰å¾…æµ‹è¯•...</div>
        </div>
    </div>

    <script>
        const CLOUD_API_URL = 'https://ai-stock-trading-backend.308186235.workers.dev';
        const LOCAL_API_URL = 'http://localhost:5000';

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            element.textContent += `[${timestamp}] ${message}\n`;
            
            const container = element.parentElement;
            container.className = 'test-item ' + (type === 'success' ? 'success' : type === 'error' ? 'error' : 'loading');
        }

        async function testCloudAPI() {
            const resultId = 'cloud-result';
            document.getElementById(resultId).textContent = '';
            log(resultId, 'ğŸ” å¼€å§‹æµ‹è¯•äº‘ç«¯API...', 'loading');
            
            try {
                // æµ‹è¯•å¥åº·æ£€æŸ¥
                log(resultId, '1. æµ‹è¯•å¥åº·æ£€æŸ¥...');
                const healthResponse = await fetch(`${CLOUD_API_URL}/api/health`);
                const healthData = await healthResponse.json();
                log(resultId, `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${healthData.status}`);
                
                // æµ‹è¯•Agentåˆ†æ
                log(resultId, '2. æµ‹è¯•Agentåˆ†æ...');
                const analysisResponse = await fetch(`${CLOUD_API_URL}/api/agent-analysis`);
                const analysisData = await analysisResponse.json();
                log(resultId, `âœ… Agentåˆ†ææˆåŠŸ: è·å–${analysisData.data.length}æ¡æ•°æ®`);
                
                // æµ‹è¯•è´¦æˆ·ä½™é¢
                log(resultId, '3. æµ‹è¯•è´¦æˆ·ä½™é¢...');
                const balanceResponse = await fetch(`${CLOUD_API_URL}/api/account-balance`);
                const balanceData = await balanceResponse.json();
                log(resultId, `âœ… è´¦æˆ·ä½™é¢æˆåŠŸ: æ€»èµ„äº§Â¥${balanceData.data.balance.totalAssets}`);
                
                // æµ‹è¯•æŒä»“ä¿¡æ¯
                log(resultId, '4. æµ‹è¯•æŒä»“ä¿¡æ¯...');
                const positionsResponse = await fetch(`${CLOUD_API_URL}/api/account-positions`);
                const positionsData = await positionsResponse.json();
                log(resultId, `âœ… æŒä»“ä¿¡æ¯æˆåŠŸ: ${positionsData.data.length}åªè‚¡ç¥¨`);
                
                log(resultId, 'ğŸ‰ äº‘ç«¯APIæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼', 'success');
                
            } catch (error) {
                log(resultId, `âŒ äº‘ç«¯APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testLocalAPI() {
            const resultId = 'local-result';
            document.getElementById(resultId).textContent = '';
            log(resultId, 'ğŸ” å¼€å§‹æµ‹è¯•æœ¬åœ°API...', 'loading');
            
            try {
                // æµ‹è¯•å¥åº·æ£€æŸ¥
                log(resultId, '1. æµ‹è¯•å¥åº·æ£€æŸ¥...');
                const healthResponse = await fetch(`${LOCAL_API_URL}/health`);
                const healthData = await healthResponse.json();
                log(resultId, `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${healthData.status}`);
                
                // æµ‹è¯•ä½™é¢è·å–
                log(resultId, '2. æµ‹è¯•ä½™é¢è·å–...');
                const balanceResponse = await fetch(`${LOCAL_API_URL}/balance`);
                const balanceData = await balanceResponse.json();
                if (balanceData.success) {
                    log(resultId, `âœ… ä½™é¢è·å–æˆåŠŸ: Â¥${balanceData.data.available_cash}`);
                } else {
                    log(resultId, `âŒ ä½™é¢è·å–å¤±è´¥: ${balanceData.error}`);
                }
                
                log(resultId, 'ğŸ‰ æœ¬åœ°APIæµ‹è¯•å®Œæˆï¼', 'success');
                
            } catch (error) {
                log(resultId, `âŒ æœ¬åœ°APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log(resultId, 'ğŸ’¡ è¯·ç¡®ä¿æœ¬åœ°APIæœåŠ¡å™¨æ­£åœ¨è¿è¡Œ (python enhanced_local_api.py)');
            }
        }

        async function testIntegration() {
            const resultId = 'integration-result';
            document.getElementById(resultId).textContent = '';
            log(resultId, 'ğŸ” å¼€å§‹é›†æˆæµ‹è¯•...', 'loading');
            
            try {
                // 1. æµ‹è¯•äº‘ç«¯API
                log(resultId, 'ç¬¬1æ­¥: æµ‹è¯•äº‘ç«¯APIè¿æ¥...');
                const cloudHealth = await fetch(`${CLOUD_API_URL}/api/health`);
                const cloudData = await cloudHealth.json();
                log(resultId, `âœ… äº‘ç«¯APIè¿æ¥æ­£å¸¸: ${cloudData.status}`);
                
                // 2. æµ‹è¯•æœ¬åœ°API
                log(resultId, 'ç¬¬2æ­¥: æµ‹è¯•æœ¬åœ°APIè¿æ¥...');
                try {
                    const localHealth = await fetch(`${LOCAL_API_URL}/health`);
                    const localData = await localHealth.json();
                    log(resultId, `âœ… æœ¬åœ°APIè¿æ¥æ­£å¸¸: ${localData.status}`);
                } catch (error) {
                    log(resultId, `âš ï¸ æœ¬åœ°APIè¿æ¥å¤±è´¥: ${error.message}`);
                    log(resultId, 'ğŸ’¡ æœ¬åœ°APIå¯èƒ½æœªå¯åŠ¨ï¼Œä½†äº‘ç«¯APIæ­£å¸¸');
                }
                
                // 3. æµ‹è¯•æ•°æ®è·å–
                log(resultId, 'ç¬¬3æ­¥: æµ‹è¯•æ•°æ®è·å–...');
                const analysisResponse = await fetch(`${CLOUD_API_URL}/api/agent-analysis`);
                const analysisData = await analysisResponse.json();
                log(resultId, `âœ… è·å–åˆ†ææ•°æ®: ${analysisData.data.length}æ¡è‚¡ç¥¨ä¿¡æ¯`);
                
                const balanceResponse = await fetch(`${CLOUD_API_URL}/api/account-balance`);
                const balanceData = await balanceResponse.json();
                log(resultId, `âœ… è·å–è´¦æˆ·æ•°æ®: æ€»èµ„äº§Â¥${balanceData.data.balance.totalAssets}`);
                
                log(resultId, 'ğŸ‰ é›†æˆæµ‹è¯•å®Œæˆï¼å‰ç«¯å¯ä»¥æ­£å¸¸è¿æ¥åç«¯APIï¼', 'success');
                log(resultId, 'ğŸ“± ç°åœ¨å¯ä»¥é‡æ–°å¯åŠ¨å‰ç«¯åº”ç”¨è¿›è¡Œæµ‹è¯•');
                
            } catch (error) {
                log(resultId, `âŒ é›†æˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            console.log('ğŸš€ APIè¿æ¥æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        };
    </script>
</body>
</html>
